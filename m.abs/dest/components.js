define("components/activity",["$","core/model3","models/base","widget/scroll"],function(t,e,i){var r=(t("$"),t("core/model3")),s=t("models/base"),o=t("widget/scroll"),a=r.ViewModel.extend({el:'<div class="hm_shop"> <div sn-repeat="item in activity"> <div class="hm_shop_banner" sn-tap="this.jump(item.PrdId)"><img sn-src="{{item.PrdImg}}" /></div> <div class="hm_shop_scroll"> <ul class="{{type==\'H\'?\'hm_shop_list\':\'sp_list\'}}"> <li class="{{type==\'H\'?\'hm_shop_list_item\':\'sp_list_item\'}}" sn-repeat="prd in item.data" sn-tap="this.jump(prd.PRD_ID)"> <img sn-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del></p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> </div>',jump:function(t,e){e&&this.view.forward("/item/"+e+"?from=/news/activity"+this.data.id)},initialize:function(){var t=this;t.shopApi=new s.ActivityAPI({$el:t.$(".hm_shop"),params:{h5name:"api_prod"+this.data.id},success:function(e){t.set({activity:e.data}),"H"==t.data.type&&o.bind(t.$(".hm_shop_scroll:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0})}}),t.shopApi.load()}});i.exports=a});define("components/share",["$","core/view","core/model3","bridge"],function(t,e,i){var r=(t("$"),t("core/view")),s=t("core/model3"),o=t("bridge"),a=r.extend({events:{"tap .js_weixin_timeline":function(){o.wx({type:"shareLinkURL",linkURL:this.model.data.linkURL,tagName:"abs",title:this.model.data.title,description:this.model.data.description,scene:1},function(t){self.callback(t)})},"tap .js_weixin_session":function(){o.wx({type:"shareLinkURL",linkURL:this.model.data.linkURL,tagName:"abs",title:this.model.data.title,description:this.model.data.description,scene:0},function(t){self.callback(t)})},"tap .js_qq":function(){o.qq({type:"shareLinkURL",linkURL:this.model.data.linkURL,title:this.model.data.title,description:this.model.data.description},function(t){self.callback(t)})},"tap .js_cancel":function(){this.hide()},tap:function(t){t.target==this.el&&this.hide()}},el:'<div class="cp_share_mask" style="display:none"> <div class="cp_share"> <div class="hd">{{head}}</div> <div class="bd"> <ul> <li class="js_weixin_timeline"><span>朋友圈</span></li> <li class="js_weixin_session"><span>微信</span></li> <li class="js_qq"><span>QQ</span></li> </ul> </div> <div class="ft"><b class="btn js_cancel">取消</b></div> </div> </div>',callback:function(){},initialize:function(){this.model=new s.ViewModel(this.$el,this.options)},set:function(t){return this.model.set(t),this},show:function(){return this.$el.show(),this},hide:function(){return this.$el.hide(),this}});i.exports=a});define("components/confirm",["$","core/model3"],function(t,e,i){var n=t("$"),r=t("core/model3"),s=r.ViewModel.extend({el:'<div class="cp_mask" style="display:none"> <div class="cp_confirm" style="height:{{height}}px;margin-top:-{{height/2}}px"> <div class="cp_confirm_bd" sn-html="{{content}}"></div> <div class="cp_confirm_ft"><b class="btn" sn-tap="this.cancel">取消</b><b class="btn js_confirm"  sn-tap="this.confirm">确定</b></div> </div> </div>',cancel:function(t){this.hide();var e=this.get("cancel");e&&e.call(this,t)},confirm:function(t){this.hide();var e=this.get("confirm");e&&e.call(this,t)},initialize:function(){this.listenTo(this.$el,n.fx.transitionEnd,this._hide)},show:function(){this.$el.show().addClass("show"),this.set({height:this.$(".cp_confirm")[0].offsetHeight})},_hide:function(){!this.$el.hasClass("show")&&this.$el.hide()},hide:function(){this.$el.removeClass("show")}});i.exports=s});define("components/deletion",["$","core/touch2","core/event"],function(t,e,n){var i=t("$"),r=t("core/touch2"),s=t("core/event"),o=function(t){var e=this,n=t.events;!t.width&&(t.width=80),this.$mask=i('<div style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0);display:none;z-index:3000"></div>').appendTo("body").on("touchend",function(t){var r=t.changedTouches[0];if(e.$mask.hide(),e.touch.scrollTo(0,0,200),!this._cancel){var o=document.elementFromPoint(r.pageX,r.pageY),a=e.$target[0].parentNode;if(n&&(a==o||i.contains(a,o)))for(var l in n)for(var c=o;c!=a.parentNode;c=c.parentNode)if(i(c).is(l))return n[l].call(e,s.createEvent("tap",{currentTarget:c,target:o})),!1}}).on("touchstart",function(){this._cancel=!1}).on("touchmove",function(){this._cancel=!0}),this.touch=new r(t.el,{enableVertical:!1,enableHorizontal:!0,children:t.children}),this.touch.on("start",function(n){e.$target=i(n.currentTarget),this.maxX=t.width,this.minX=0}).on("move",function(t){e.$target.css({"-webkit-transform":"translate(-"+this.x+"px,0px)"})}).on("end",function(){console.log("end"),e.$mask.show()}).on("stop",function(){this.x!=t.width&&this.scrollTo(t.width,0,50)})};o.prototype=Object.create(s),n.exports=o});define("components/month",["$","core/model3","models/base","components/size","util"],function(t,e,i){var n=t("$"),s=t("core/model3"),r=t("models/base"),o=t("components/size"),a=t("util"),l=s.ViewModel.extend({el:'<div class="uc_month_get" style="margin-bottom:10px"> <ul class="list"> <li sn-repeat="item in month"><img src="{{item.WPP_LIST_PIC}}"> <p class="con"> <span class="name">{{item.PRD_NAME}}</span> <em>￥{{item.PRD_PRICE}}</em> <del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del> <b class="btn" sn-tap="this.showSize(item)">免费领取</b> </p></li> </ul> <ul class="sp_list" style="overflow:hidden"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}" sn-index="0"> <img src="{{item.WPP_LIST_PIC}}"> <p class="price"><b>￥{{item.PRD_PRICE}}</b><del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_NAME}}</p> </li> </ul> </div>',showSize:function(t,e){this.colorAndSpec.setParam({id:e.PRH_ID}).load(),this.size.set({data:e}).show()},initialize:function(){var t=this;t.set({url:encodeURIComponent(location.hash)}),t.size=new o,t.size.$el.appendTo(n("body"));var e=new r.MonthAPI({$el:t.$el,checkData:!1,params:{freid:this.data.id},success:function(e){for(var i=[],n=0;n<e.data.length;n++)-1==a.indexOf(i,function(t){return t.PRH_ID==e.data[n].PRH_ID})&&i.push(e.data[n]);t.records=e.data,t.set({month:i})}});e.load();var i=new r.MonthProductAPI({$el:t.$el,success:function(e){t.set(e)}});i.load(),t.colorAndSpec=new r.ProductColorAndSpec({$el:t.size.$el,checkData:!1,success:function(e){for(var i=[],n=[],s=0,r=e.data.length;r>s;s++){var o=e.data[s];-1!=a.indexOf(t.records,function(t){return t.PRD_ID==o.PRD_ID})&&(-1==i.indexOf(o.PRD_COLOR)&&i.push(o.PRD_COLOR),-1==n.indexOf(o.PRD_SPEC)&&n.push(o.PRD_SPEC))}var l=t.size.data.data,o=a.first(e.data,function(t){return t.PRD_ID==l.PRD_ID});console.log(o),console.log(t.data.id),t.size.set({freid:t.data.id,type:"month",color:i,spec:n,colorSpec:e.data,data:o,qty:1})}})}});i.exports=l});define("components/shareOrder",["$","core/model3","components/share"],function(t,e,i){var s=(t("$"),t("core/model3")),r=t("components/share"),o=s.ViewModel.extend({el:'<div class="od_share"> <h1>支付成功</h1> <h2>感谢在ABS购买商品</h2> <div class="con"> <h3>恭喜您获得</h3> <h4>纳米净颜美容巾免费领取兑换券</h4> <h3>赶快呼唤好友来领取吧!</h3> <h5>*分享的礼物券中有3张被好友成功领取，就可以获得<em>500积分</em>（全场通用，可直接抵扣现金）</h5> <div class="btn" sn-tap="this.showShare()">发礼物，抢500积分</div> </div> </div>',showShare:function(){this.share.show()},initialize:function(){var t=this;t.share=new r({head:"分享礼物",title:"",linkURL:"http://m.abs.cn/",description:""}),t.share.callback=function(t){},t.share.$el.appendTo(t.$el)}});i.exports=o});define("components/size",["$","core/model3","models/base","util","widget/scroll"],function(t,e,i){var n=t("$"),s=t("core/model3"),r=t("models/base"),o=t("util"),a=t("widget/scroll"),l=s.ViewModel.extend({el:'<div class="pd_size_wrap js_size {{isShowSize?\'\':\'out\'}}" style="display:none" sn-tap="this.tap()"> <div class="pd_size"> <div class="pd_size_close" sn-tap="isShowSize=false"></div> <div class="base_info"> <div class="img"><img src="{{data.WPP_M_PIC}}" /></div> <div class="info"> <h2 class="price">¥{{data.PRD_PRICE}}</h2> <div class="qty">库存{{data.PRD_NUM}}件</div> <p class="other"> <em>选择</em> <em>尺码</em> <em>颜色分类</em> </p> </div> </div> <div class="pd_size_con"> <div class="pd_size_select"> <div class="hd">尺码</div> <ul> <li sn-repeat="item in spec" class="{{data.PRD_SPEC==item?\'curr\':\'\'}}" sn-tap="data.PRD_SPEC=item">{{item.split(\'|\')[0]}}</li> </ul> </div> <div class="pd_size_select"> <div class="hd">颜色分类</div> <ul> <li sn-repeat="item in color" class="{{data.PRD_COLOR==item?\'curr\':\'\'}}" sn-tap="data.PRD_COLOR=item">{{item}}</li> </ul> </div> </div> <div class="pd_size_buy"> <p class="hd">购买数量</p> <p class="qty"><em sn-tap="qty=Math.max(1,qty-1)">-</em> <input type="text" class="qty" value="{{qty}}" /> <em sn-tap="qty=qty+1">+</em> </p> </div> <b class="btn_large btn_confirm" sn-tap="this.confirm()">确认</b> </div> </div>',show:function(){this.$el.show(),this.set({isShowSize:!0})},confirm:function(t){var e=this,i=e.get("colorSpec"),n=e.get("data"),s=o.first(i,function(t){return t.PRD_SPEC==n.PRD_SPEC&&t.PRD_COLOR==n.PRD_COLOR});e.cartAddAPI.setParam({prd:s.PRD_ID,qty:e.get("qty")}).load()},hide:function(){this.set({isShowSize:!1})},tap:function(t){n(t.target).hasClass("js_size")&&this.hide()},initialize:function(){var t=this;t.user=o.store("user"),a.bind(t.$(".pd_size_con")),t.listenTo(t.$el,n.fx.transitionEnd,function(e){t.$el.hasClass("out")&&t.$el.hide()}),t.cartAddAPI=new r.CartAddAPI({$el:t.$el,checkData:!1,check:!1,beforeSend:function(){"month"==t.data.type?this.setUrl("/api/prod/addmemberbag").setParam({prdid:t.get("data").PRD_ID,freid:t.get("freid")}):this.setParam({prd:t.get("data").PRD_ID}),t.$(".js_buy").addClass("disabled")},params:{pspcode:t.user.Mobile},success:function(e){e.success&&(sl.tip("加入购物车成功！"),t.hide())},complete:function(){t.$(".js_buy").removeClass("disabled")}})}});i.exports=l});define("models/base",["widget/loading"],function(t,e,n){var i=t("widget/loading"),r=i.extend({baseUri:$('meta[name="api-base-url"]').attr("content")});e.API=r,e.OrderStatusAPI=r.extend({url:"/api/user/get_order_status",checkData:!1,check:!1,params:{id:0}}),e.CouponStatusAPI=r.extend({url:"/api/user/get_coupon_status",checkData:!1,check:!1,params:{id:0}});var s=i.extend({baseUri:$('meta[name="shop-api-base-url"]').attr("content"),KEY_PAGE:"currentpage"});e.ShopAPI=s,e.AddressListAPI=s.extend({url:"/api/user/addresslist",params:{pspcode:0}}),e.EditAddressAPI=s.extend({url:"/api/user/editaddress",params:{pspcode:0,edittype:2,mbaId:0,mbaName:"",mbaMobile:0,mbaCtyId:0,mbaDefault:!1,mbaRegId:0,mbaAddress:""}}),e.DeleteAddressAPI=s.extend({url:"/api/user/deladdress",params:{pspcode:0,mbaId:0}}),e.ProvinceAPI=s.extend({url:"/api/user/prvlist"}),e.CityAPI=s.extend({url:"/api/user/ctylist",params:{prvId:0}}),e.RegionAPI=s.extend({url:"/api/user/reglist",params:{ctyId:0}}),e.CouponAPI=s.extend({url:"/api/user/GetCoupon",params:{pspcode:"",csvcode:""}}),e.AvailableCouponAPI=s.extend({url:"/api/prod/availablecoupon",params:{pspcode:""}}),e.GetSharedCouponAPI=r.extend({url:"/api/user/get_shared_coupon",params:{UserID:0,Auth:"",data:""}}),e.CouponUserAPI=r.extend({url:"/api/user/get_coupon_user",params:{data:""}}),e.CreateOrderAPI=s.extend({url:"/api/shop/CreateMOrder",params:{pspcode:"",mba_id:1,pay_type:1,coupon:"",points:0,freecoupon:""}}),e.CategoryAPI=s.extend({url:"/api/prod/pcglist"}),e.SubCategoryAPI=s.extend({url:"/api/prod/pcgitem",params:{id:0}}),e.ProductSearchAPI=s.extend({url:"/Prod/productlist",params:{keycodes:"",orderbyStr:2,orderby:"desc",length:2,pages:0}}),e.ProductHeadAPI=s.extend({url:"/api/prod/prhitem",params:{id:0}}),e.ProductAPI=s.extend({url:"/api/prod/prditem",params:{id:0}}),e.ProductColorAndSpec=s.extend({url:"/api/prod/getsizebyprh",params:{id:0}}),e.ProductDetailAPI=s.extend({url:"/api/prod/prddetail",params:{id:0}}),e.ProductListAPI=s.extend({url:"/api/prod/pcgprd",params:{pcgid:0}}),e.NewProductAPI=s.extend({url:"/api/prod/newproductlist",params:{length:100,pages:0}}),e.ActivityAPI=s.extend({url:"/Prod/GetApiBannerPrd",params:{h5name:"api_prod1"}}),e.CartAPI=s.extend({url:"/api/shop/bag",params:{pspcode:0}}),e.CartAddAPI=s.extend({url:"/api/shop/addbag",params:{pspcode:0,prd:0,qty:1}}),e.CartModifyAPI=s.extend({url:"/api/shop/SaveProductChangeRow",params:{pspcode:0,spbId:0,qty:1}}),e.CartDeleteAPI=s.extend({url:"/api/shop/deletebag",params:{pspcode:0,spbId:0}}),e.CancelOrderAPI=s.extend({url:"/shop/cancelOrder",params:{pspcode:"",purcode:""}}),e.OrderCreateAPI=s.extend({url:"/api/shop/CreateMOrder",params:{pspcode:"",mba_id:0,pay_type:1,coupon:"",points:0,freecoupon:""}}),e.WxPayAPI=r.extend({url:"/api/shop/wxpayqrcode",checkData:!1,params:{order_no:""}}),e.StewardListAPI=s.extend({url:"/api/steward/list",params:{pspid:0}}),e.StewardAPI=s.extend({url:"/api/steward/item",params:{prh_id:0}}),e.StewardDetailAPI=s.extend({url:"/api/steward/detail",params:{detail_id:0}}),e.MonthAPI=s.extend({url:"/api/prod/freeskulist",params:{freid:2}}),e.MonthProductAPI=s.extend({url:"/api/prod/ajaxactprdlist",params:{pages:1,len:6}})});define("core/model3",["$","util","./base","./event","./component"],function(t,e,n){var y,i=t("$"),r=t("util"),o=(t("./base"),t("./event")),a=t("./component"),u=/^((-)*\d+|true|false|undefined|null|'(?:\\'|[^'])*')$/,h=/([a-zA-Z_0-9]+)(?:\s*,(\s*[a-zA-Z_0-9]+)){0,1}\s+in\s+([a-zA-Z_0-9]+(?:\.[a-zA-Z_0-9]+){0,})(?:\s*\|\s*filter\s*\:\s*(.+?)){0,1}(?:\s*\|\s*orderBy\:(.+)){0,1}(\s|$)/,p=/\{\{(.+?)\}\}/g,d=/'(?:\\'|[^'])*'|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^\/\r\n])+\/[img]*(?=[\)|\.|,])|\/\/.*|(^|[\!\=\>\<\?\s\:\(\),\%&\|\+\-\*\/\[\]]+)([\$a-zA-Z_0-9]+(?:\.[a-zA-Z_0-9]+)*(?![a-zA-Z_0-9]*\())/g,f=/([a-zA-Z_0-9]+(?:\.[a-zA-Z_0-9]+)*)\s*=\s*((?:\((?:'(?:\\'|[^'])*'|[^\)])+\)|'(?:\\'|[^'])*'|[^;])+?)(?=\;|\,|$)/g,m=/\b(this\.[\.\w]+\()((?:'(?:\\'|[^'])*'|[^\)])*)\)/g,g=function(t){for(var e=t.split("."),n=[],i="",r=0;r<e.length;r++)n[r]=(0==r?"$data":n[r-1])+"."+e[r];for(var r=0;r<n.length;r++)i+=(r?"&&":"")+n[r]+"!==null&&"+n[r]+"!==undefined";return"(("+i+")?"+t+':"")'},v=function(t,e){for(var n=t.length?t:[t],i=0,r=n.length;r>i;i++){var s=n[i];e(s,i,n),1==s.nodeType&&s.childNodes.length&&v(s.childNodes,e)}},x={contains:function(t,e){return-1!=t.indexOf(e)},like:function(t,e){return-1!=t.indexOf(e)||-1!=e.indexOf(t)},util:r,closestModelData:function(t,e){for(t=t.parentNode;null!=t;t=t.parentNode)if(t.repeat&&(!e||t.repeat.repeat.alias==e))return t.model.data}},_=function(t,e,n,r){if(t instanceof _)this.key=t.key?t.key+"."+e:e;else{if(!(t instanceof E))throw new Error("Model's parent mast be Collection or Model");this.key=t.key+"^child"}if(this.type=i.isPlainObject(n)?"object":"value",t.data[e]=this.data="object"==this.type?i.extend({},n):n,this._key=e,this.model={},this.parent=t,this.root=t.root,r)for(var s=0,o=r.length;o>s;s++)r[s].add(this);this.set(n)},w={getModel:function(t){if("string"==typeof t&&-1!=t.indexOf(".")&&(t=t.split(".")),i.isArray(t)){var e=this;if("this"==t[0]){for(var n=1,r=t.length;r>n;n++)if(!(e=e[t[n]]))return null}else for(var n=0,r=t.length;r>n;n++)if(e instanceof _)e=e.model[t[n]];else{if(!(e instanceof E))return null;e=e.models[t[n]]}return e}return"this"==t?this:""==t?this.data:this.model[t]},get:function(t){var e=this.getModel(t);return e instanceof _||e instanceof E?e.data:e},cover:function(t,e){return this.set(!0,t,e)},set:function(t,e,n){var s,a,c,r=this,l=r.model;if(t!==!0&&(n=e,e=t,t=!1),i.isPlainObject(e))a=e;else if(null===e)!t&&(t=!0),a={};else{if("undefined"==typeof n)return n=e,e="",c=this.parent,c.data[c instanceof E?c.models.indexOf(this):this._key]=n,this.data=n,this._triggerChangeEvent(this.key);(a={})[e]=n}if(i.isPlainObject(this.data)||(this.data={}),t)for(var u in this.data)void 0===a[u]&&(a[u]=null);i.extend(!0,this.data,a);for(var u in a)if(s=l[u],value=a[u],s!==value){var h=u.split(".");if(h.length>1){e=h.pop(),l=this;for(var f,p=0,d=h.length;d>p;p++)if(u=h[p],f=l,l instanceof _)l=l.model[u],l||(l=f.model[u]=new _(f,u,null));else if(l instanceof E&&(l=l.models[u],!l))throw new Error("[Collection index is bigger than length!]");l.set(e,value)}else if(s instanceof _)null===value||void 0===value?s.clear():s.set(value);else if(s instanceof E){if(!i.isArray(value)){if(null!=value)throw new Error("[Array to "+typeof value+" error]不可改变"+u+"的数据类型");value=[]}s.set(value)}else i.isPlainObject(value)?l[u]=new _(this,u,value):i.isArray(value)?l[u]=new E(this,u,value):(l[u]=value,this._triggerChangeEvent(this.key?this.key+"/"+u:u,s,value))}return this._triggerChangeEvent(this.key),r},_triggerChangeEvent:function(t,e,n){return this.root.init||this.root.trigger("change"+(t?":"+t:"").replace(/\./g,"/"),this,e,n),this},clear:function(){var t={};for(var e in this.data)t[e]=null;this.set(t)},closest:function(t){for(var e=this.parent;null!=e;e=e.parent)if(e.key==t)return e},contains:function(t){for(t=t.parent;null!=t;t=t.parent)if(t==this)return!0;return!1},_eachEl:function(t,e,n){for(var i;null!=t;t=t.parentNode){if(void 0!==(i=e(t)))return i;if(1==t.nodeType&&t.getAttribute("sn-viewmodel"))break}return void 0===n?this:n},isRelativeToEl:function(t){for(var e=!0,n=this,i=this;null!=i;i=i.parent)if(i instanceof E){e=!1;break}return e?!0:n._eachEl(t,function(t){return t.model&&t.model==n?!0:void 0},!1)}};w.reset=w.clear,_.prototype=i.extend(Object.create(o),w);var b=function(t){i.extend(this,t);for(var e=this,n=this.collectionName.split("."),r=this.parent;r;){if(r.alias==n[0]){n[0]=r.collectionName+"^child",this.collectionName=n.join("."),this.isChild=!0;break}r=r.parent}var s=document.createComment(this.collectionName);if(s.repeat=this,this.replacement=s,this.el.parentNode.insertBefore(s,this.el),this.el.parentNode.removeChild(this.el),this.collectionRepeats=[],this.filters){var o=this.viewModel._compile("{{"+this.filters+"}}",this,function(t,n){for(var i=0;i<e.collectionRepeats.length;i++){var r=e.collectionRepeats[i];(n.parent==r.collection||n.contains(r.collection))&&r.update()}});this.filter=this.viewModel.fns.length+this.viewModel._fns.length,this.viewModel._fns.push(o)}},A=function(t,e,n){var i=this;if(this.collection=t,this.repeat=e,this.children=[],this.parentModel=n,e.collectionRepeats.push(this),e.parent)if(e.isChild||n)this.type="children",this.replacement=this.findReplacement(n||t.parent);else{this.type="inset";for(var r=0;r<e.parent.collectionRepeats.length;r++){var s=e.parent.collectionRepeats[r];s.collection.on("add",function(n,r){for(var s=new A(t,e,r),o=0;o<t.models.length;o++)s.add(t.models[o]);i.children.push(s),s.update()}).each(function(n){i.children.push(new A(t,e,n))}),s.children.push(this)}}else this.type="normal",this.replacement=e.replacement;this.el=this.cloneNode(e.el),this.elements=[]};A.prototype={findReplacement:function(t){for(;null!=t&&t!=t.root;t=t.parent)if(t instanceof _&&t.replacement)for(var e=0;e<t.replacement.length;e++)if(t.replacement[e].repeat==this.repeat)return t.replacement[e]},update:function(){if("inset"!=this.type){var n=document.createDocumentFragment(),i=0,r=this.elements,s=this.repeat,o=s.orderBy,a=this.collection.root;o&&r.sort(function(t,e){return t=t.model.data[o],e=e.model.data[o],t>e?1:e>t?-1:0});for(var t=0,e=r.length;e>t;t++){var l=r[t];void 0===s.filter||a.fns[s.filter].call(a,x,l.model,this.replacement)?(n.appendChild(l),l.setAttribute("sn-index",i),s.indexAlias&&(l.setAttribute("sn-index-alias",s.indexAlias),a._triggerChangeEvent(s.collectionName+"/"+s.alias+"/"+s.indexAlias,l.model)),i++):l.parentNode&&l.parentNode.removeChild(l)}this.replacement.parentNode.insertBefore(n,this.replacement)}else for(var t=0,e=this.children.length;e>t;t++)this.children[t].update()},cloneNode:function(t,e,n){var r,i=t.cloneNode(!1);if(t==this.el&&(i.repeat=this,i.model=e),n&&n.appendChild(i),8==t.nodeType&&t.repeat)i.repeat=t.repeat,e&&(e.replacement||(e.replacement=[])).push(i);else if(t.bindings&&(i.bindings=t.bindings,e?(t._origin._elements.push(i),e.root._setElAttr(i)):i._origin=t),1==t.nodeType&&(r=t.childNodes.length))for(var s=0;r>s;s++)this.cloneNode(t.childNodes[s],e,i);return i},"do":function(t){if("inset"==this.type)for(var e=0;e<this.children.length;e++)this.children[e]["do"](t);else t.call(this);return this},each:function(t,e,n){return"function"!=typeof e&&(n=e,e=null),this["do"](function(){for(var i=this.elements.length-1,r=i;r>=0;r--){var s=n?r:i-r;if(t.call(this,s,this.elements[s])===!1)break}e&&e.call(this)})},remove:function(t,e){return this["do"](function(n,r){if("function"==typeof t)for(var n=this.elements.length-1;n>=0;n--){var r=this.elements[n];t(r,n)&&(this.elements.splice(n,1),i(r).remove())}else this.elements.splice(t,e||1).forEach(function(t){i(t).remove()})})},add:function(t){return this["do"](function(e,n){this.elements.push(this.cloneNode(this.el,t))})},clear:function(){return this.each(function(t,e){e.parentNode.removeChild(e)},function(){this.elements.length=0},!0)}};var E=function(t,e,n){var i;if(this.models=[],this.parent=t,this.key=t.key?t.key+"."+e:e,this._key=e,this.root=t.root,this.repeats=[],i=t.root.repeats[this.key])for(var r=0;r<i.length;r++)this.repeats.push(new A(this,i[r]));this.data=[],t.data[e]=this.data,this.add(n)};E.prototype=Object.create(o),E.prototype.each=function(t){for(var e=0;e<this.models.length;e++)t.call(this,this.models[e]);return this},E.prototype.find=function(t){for(var e=0;e<this.models.length;e++)if(t.call(this,this.data[e],e))return this.models[e];return null},E.prototype.add=function(t){var e,n;i.isArray(t)||(t=[t]);for(var r=0,s=t.length;s>r;r++){var o=t[r];n=this.data.length,e=new _(this,n,o,this.repeats),this.models.push(e),this.trigger("add",e)}for(var r=0,a=this.repeats.length;a>r;r++)this.repeats[r].update();this._triggerChangeEvent()},E.prototype._triggerChangeEvent=function(){this._silent||this.root._triggerChangeEvent(this.key,this,this.data)._triggerChangeEvent(this.key+"/length",this,this.data.length)},E.prototype.remove=function(t,e){this.models.splice(t,e||1),this.data.splice(t,e||1);for(var n=0,i=this.repeats.length;i>n;n++)this.repeats[n].remove(t,e);this._triggerChangeEvent()},E.prototype.clear=function(t){this.models.length=this.data.length=0;for(var e=0,n=this.repeats.length;n>e;e++)this.repeats[e].clear();this._triggerChangeEvent()},E.prototype.set=function(t){if(this._silent=!0,0==t.length)this.clear();else{t.length<this.data.length&&this.remove(t.length,this.data.length-t.length);var e=0;this.each(function(n){n.set(!0,t[e]),e++}),this.add(t.slice(e,t.length))}return this._silent=!1,this._triggerChangeEvent(),this},E.prototype.get=function(t){return this.models[t]};var $=["tap","click","change","focus","blur","transition-end"],T=["this","$","Math","new","Date","encodeURIComponent","window","document"],k=function(t,e){var n=",$data=$.extend({},global,model.root.data,{$state:global.State.data}";if(t){n+=",{";for(var i=t.parent,r=t;null!=i;r=i,i=i.parent)n+=i.alias+":"+(r.isChild?"model.closest('"+i.collectionName+"^child').data":'global.closestModelData(el,"'+i.alias+'")')+",",i.indexAlias&&(n+=i.indexAlias+":$el.closest('[sn-index-alias=\""+i.indexAlias+'"]\').attr("sn-index"),');n+=t.alias+":model.data",t.indexAlias&&(n+=","+t.indexAlias+":$el.closest('[sn-index-alias=\""+t.indexAlias+'"]\').attr("sn-index")'),n+="}"}return n+=");with($data){"+e+"}"},S=function(t,e){"undefined"!=typeof e||void 0!=t&&!i.isPlainObject(t)||(e=t,t=this.el),this.cid=r.guid(),this._bindListenTo=[],this.data=i.extend({},e),this.model={},this.repeats={},this._fns=[],this.fns=[],this.root=this,this.scan(t),this.init=!0,this.set(this.data),this.init=!1,this.on("Destroy",this.onDestroy),this.initialize.call(this,arguments)};S.prototype=i.extend(Object.create(_.prototype),{key:"",initialize:r.noop,setState:function(t,e,n){return y.set(t,e,n),this},getState:function(t){return y.get(t)},_compile:function(t,e,n){var i=this,r="try{return '"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(p,function(t,r){return"'+("+r.replace(/\\\\/g,"\\").replace(/\\'/g,"'").replace(d,function(t,r,s){if(!s)return t;var o=s.split("."),a=o[0];if("$state"==a)return y.on("change:"+s.replace("$state.","").replace(/\./g,"/"),n),r+s;if(!a||x[a]||-1!=T.indexOf(a)||u.test(s))return r+s;var l;if(e)for(var c=e;null!=c;c=c.parent){if(a==c.alias){o[0]=c.collectionName+"^child";break}if(a==c.indexAlias){l=c;break}}var h=l?l.collectionName+"/"+l.alias+"/"+l.indexAlias:o.join("/").replace(/\./g,"/");return i.on("change:"+h,n),r+g(s)})+")+'"})+"';}catch(e){return '';}",s="function(global,model,el){var $el=$(el)"+k(e,r.replace("return ''+","return ").replace(/\+\'\'/g,""))+"}";return s},_setElAttr:function(t,e){var n=this;if(t.bindings){e?[e]:t.bindings;for(var e in t.bindings){var s=n.fns[t.bindings[e]].call(n,x,n._closestByEl(t),t);switch(e){case"textContent":t.textContent!==s+""&&(t.textContent=s);break;case"value":"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName?t.value!=s&&(t.value=s):t.setAttribute(e,s);break;case"html":case"sn-html":t.innerHTML=s;break;case"display":case"sn-display":t.style.display=r.isFalse(s)?"none":"block"==s||"inline"==s||"inline-block"==s?s:"";break;case"style":t.style.cssText+=s;break;default:t.setAttribute(e,s)}}}},_bindAttr:function(t,e,n,i){var r=this;if(p.test(n)){var s=function(n,s){if(i)for(var o=0;o<t._elements.length;o++){var a=t._elements[o];(s==this||s.isRelativeToEl(a))&&r._setElAttr(a,e)}else r._setElAttr(t,e)};(t.bindings||(t._elements=[],t.bindings={}))[e]=r.fns.length+r._fns.length;var o=r._compile(n,i,s);r._fns.push(o)}},_closestByEl:function(t){return this._eachEl(t,function(t){return t.model?t.model:void 0})},_getByEl:function(t,e){var n=this,i=e.split("."),r=i[0];return"this"==r?n:"$state"==r?$state:this._eachEl(t,function(t){return t.repeat&&t.repeat.repeat.alias==r?t.model:void 0})},_getVal:function(t,e){var t=t==this||t instanceof _?t:this._getByEl(t,e);return t.get(t==this?e:e.replace(/^[^\.]+\./,""))},_setByEl:function(t,e,n){var i=this._getByEl(t,e);i.set(i==this||i==y?e:e.replace(/^[^\.]+\./,""),n)},scan:function(t){var e=this,n=[],r=i(t).attr("sn-viewmodel",this.cid).on("input change","[sn-model]",function(t){if(1!=t._stopModelEvent){var n=t.currentTarget,i=n.getAttribute("sn-model");e._setByEl(n,i,n.value),t._stopModelEvent=!0}}).each(function(){this.model=e});e.$el=e.$el?e.$el.add(r):r;for(var a,l,s=function(t){if(1!=t._stopModelEvent){var a,l,n=t.currentTarget,i=n.getAttribute("sn-"+t.type),r=i.split(":"),o=[t];if(/^\d+$/.test(i)){var c=e._closestByEl(n);c.root===e&&e.fns[i].call(e,t,c,x)}else{for(var u=0;u<r.length;u++){var h=r[u];0==u?(l=e._getByEl(n,h),a=e._getVal(l,h),t.model=e._closestByEl(n,h)):o.push(e._getVal(n,h))}a.apply(l,o)}t._stopModelEvent=!0}},o=0;o<$.length;o++)a="transition-end"==$[o]?i.fx.transitionEnd:$[o],l="[sn-"+$[o]+"]",r.on(a,l,s).filter(l).on(a,s);v(r,function(t,i,r){if(1==t.nodeType){var s=t.getAttribute("sn-repeat");if(null!=s){var o=s.match(h),a=o[3],l=0==a.indexOf("$state")?y:e;s=new b({root:e,viewModel:l,parent:r.repeat,alias:o[1],indexAlias:o[2],collectionName:a,filters:o[4],orderBy:o[5],el:t}),(l.repeats[s.collectionName]||(l.repeats[s.collectionName]=[])).push(s)}else s=r.repeat;s&&(t.childNodes.repeat=s);for(var c=0;c<t.attributes.length;c++){var u=t.attributes[c].name,p=t.attributes[c].value;if(p)if("sn-error"==u?u="onerror":"sn-src"==u&&(u="src"),"sn-display"==u||"sn-html"==u||0!=u.indexOf("sn-"))0==u.indexOf("sn-")&&-1==p.indexOf("{{")&&-1==p.indexOf("}}")&&(p="{{"+p+"}}"),e._bindAttr(t,u,p,s);else if(-1!=$.indexOf(u.replace(/^sn-/,""))&&(f.test(p)||m.test(p))){var d=p.replace(m,function(t,e,n){return e+"e"+(n?",":"")+n+")"}).replace(f,'this._setByEl(e.currentTarget,"$1",$2)'),g="function(e,model,global){var el=e.currentTarget"+k(s,d)+"}";t.setAttribute(u,e.fns.length+e._fns.length),e._fns.push(g)}}!s&&t.bindings&&n.push(t)}else 3==t.nodeType&&(e._bindAttr(t,"textContent",t.textContent,r.repeat),!r.repeat&&t.bindings&&n.push(t))}),this.fns=this.fns.concat(window.eval("["+this._fns.join(",")+"]")),this._fns.length=0;for(var o=0,c=n.length;c>o;o++)e._setElAttr(n[o])}},r.pick(a.prototype,["destroy","undelegateEvents","listenTo","listen","onDestroy","$"])),S.extend=r.extend,x.State=y=new S,e.ViewModel=S,e.Filters=x});define("core/touch2",["$","util","animation","../graphics/cubicBezier","./event"],function(t,e,n){var i=t("$"),s=(t("util"),t("animation")),o=t("../graphics/cubicBezier"),a=t("./event"),c=(Array.prototype.slice,new o(.08,.53,.2,.96)),u=function(t,e){var n=this,r=i(t);n.$el=r,n.el=r[0],n.options=i.extend({enableVertical:!0,enableHorizontal:!1},e),this.delegate("touchstart",n.options.children,n._start).delegate("touchmove",n.options.children,n._move).delegate("touchend",n.options.children,n._end)};return u.prototype=Object.create(a),i.extend(u.prototype,{minDelta:0,minX:0,maxX:0,minY:0,maxY:0,x:0,y:0,delegate:function(t,e,n){return"undefined"==typeof e&&"function"==typeof n&&(e=n),"function"==typeof e?this.$el.on(t,i.proxy(e,this)):this.$el.on(t,e,i.proxy(n,this)),this},_stopMomentum:function(){return this.momentum?(this.momentum.stop(),this._isClickStopAni=!0,!0):!1},_start:function(t){var e=this,n=t.touches[0];e.pointX=e.startPointX=e.sx=n.pageX,e.pointY=e.startPointY=e.sy=n.pageY,e.isTouchStop=!1,e.isTouchStart=!1,e.isTouchMoved=!1,e.startTime=t.timeStamp||Date.now(),e.startX=e.x,e.startY=e.y,e.isClickStopMomentum=e._stopMomentum(),e.timestamp=Date.now()},_move:function(t){if(!this.isTouchStop){var e=this,n=t.touches[0],i=e.startPointX-n.pageX,r=e.startPointY-n.pageY;if(e.deltaX=i,e.deltaY=r,!e.isTouchStart){var s=Math.abs(i)>=e.minDelta&&Math.abs(i)>Math.abs(r),o=!s;if(!o&&!s)return!1;if(o&&!e.options.enableVertical||s&&!e.options.enableHorizontal)return void this.stop();if(e.isTouchStart=!0,e.isDirectionY=o,e.isDirectionX=s,e.dir=s,e.isInit||(e.trigger(a.createEvent("init",{currentTarget:t.currentTarget})),e.isInit=!0),e.trigger(a.createEvent("start",{currentTarget:t.currentTarget})),e.isTouchStop)return}var l=e.startX+i,c=e.startY+r;return e.x=l<e.minX?e.minX+(l-e.minX)/2:l>e.maxX?e.maxX+(l-e.maxX)/2:l,e.y=c<e.minY?e.minY+(c-e.minY)/2:c>e.maxY?e.maxY+(c-e.maxY)/2:c,e.trigger(a.createEvent("move",{currentTarget:t.currentTarget})),e.isTouchMoved=!0,e.isMoveLeft=e.pointX-n.pageX>0?!0:e.pointX==n.pageX?e.isMoveLeft:!1,e.isMoveTop=e.pointY-n.pageY>0?!0:e.pointY==n.pageY?e.isMoveTop:!1,e.oldPointX=e.pointX,e.oldPointY=e.pointY,e.pointX=n.pageX,e.pointY=n.pageY,e.timestamp=Date.now(),!1}},_end:function(t){var e=this;if((!e.isTouchMoved||e.isTouchStop)&&e._isClickStopAni)return e._stop(),void(t.cancelTap=!0);if(e.isTouchMoved&&(e.isTouchMoved=!1,!e.isTouchStop)){if(e.isTouchStop=!0,i(t.target).trigger("touchcancel"),e.trigger("end"),e.options.enableHorizontal&&(e.x<e.minX||e.x>e.maxX)||e.options.enableVertical&&(e.y<e.minY||e.y>e.maxY))return void e.bounceBack();var r,o,u,h,p,d,f,n=t.changedTouches[0],a=e.x,l=e.y;return Date.now()-e.timestamp<50?(r=n.pageX-e.oldPointX,o=n.pageY-e.oldPointY,u=r*Math.abs(r),h=o*Math.abs(o),f=80*Math.abs(Math.max(r,o)),e.momentum=s.animate(function(t,n,i){t=c.get(n/i),p=a+u*t*-1,d=l+h*t*-1,e.options.enableVertical&&(d<e.minY||d>e.maxY)||e.options.enableHorizontal&&!e.options.enableVertical&&(p<e.minX||p>e.maxX)?(e.momentum.stop(),u=a-u,h=l-h,a=e.x,l=e.y,u=u<e.minX?e.minX+Math.max(-100,(u-e.minX)/36):u>e.maxX?e.maxX+Math.min(100,(u-e.maxX)/36):u,h=h<e.minY?e.minY+Math.max(-100,(h-e.minY)/36):h>e.maxY?e.maxY+Math.min(100,(h-e.maxY)/36):h,h-=l,u-=a,e.momentum=s.animate(function(t){e.x=a+u*t,e.y=l+h*t,e.trigger("move")},Math.min(200,(i-n)/4),"easeOutCubic",function(){e.bounceBack()})):(e.x=p<e.minX?e.minX:p>e.maxX?e.maxX:p,e.y=d,e.trigger("move"))},f,"ease",function(){e._stop()})):e._stop(),!1}},bounceBack:function(){var t=this,e=t.x,n=t.y,i=0,r=0;t.options.enableHorizontal&&(t.x<t.minX?i=t.minX-t.x:t.x>t.maxX&&(i=t.maxX-t.x)),t.options.enableVertical&&(t.y<t.minY?r=t.minY-t.y:t.y>t.maxY&&(r=t.maxY-t.y)),s.animate(function(s){t.x=e+i*s,t.y=n+r*s,t.trigger("move")},200,"ease",function(){t._stop()})},scrollTo:function(t,e,n){var i=this;if(t=i.options.enableHorizontal?t>=this.maxX?this.maxX:t<=this.minX?this.minX:t:i.x,e=i.options.enableVertical?e>=this.maxY?this.maxY:e<=this.minY?this.minY:t:i.x,n){var r=i.x,o=i.y,a=t-i.x,l=e-i.x;s.animate(function(t){i.x=r+a*t,i.y=o+l*t,i.trigger("move")},n,"ease")}else i.x=t,i.y=e,i.trigger("move")},stop:function(){this.isTouchStop=!0},_stop:function(){this.momentum=null,this._isClickStopAni=!1,this.trigger("stop")},destory:function(){this.$el.off("touchstart",this._start).off("touchmove",this._move).off("touchend",this._end)}}),u});
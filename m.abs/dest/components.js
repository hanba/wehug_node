define("components/activity",["$","core/model3","models/base","widget/scroll"],function(t,e,i){var r=(t("$"),t("core/model3")),s=t("models/base"),o=t("widget/scroll"),a=r.ViewModel.extend({el:'<div class="main"> <div class="hm_shop"> <div sn-repeat="item in activity"> <div class="hm_shop_banner" sn-tap="this.jump(item.PrdId)"><img sn-src="{{item.PrdImg}}" /></div> <div class="hm_shop_scroll"> <ul class="{{type==\'H\'?\'hm_shop_list\':\'sp_list\'}}"> <li class="{{type==\'H\'?\'hm_shop_list_item\':\'sp_list_item\'}}" sn-repeat="prd in item.data" sn-tap="this.jump(prd.PRD_ID)"> <img sn-src="{{prd.WPP_LIST_PIC}}" /> <p class="price">￥{{prd.PRD_PRICE}} <del sn-display="{{prd.PRD_SPECIAL_FLAG}}">¥{{prd.PRD_MEMBER_PRICE}}</del></p> <p class="name">{{prd.PRD_NAME}}</p> </li> </ul> </div> </div> </div> </div>',jump:function(t,e){e&&this.view.forward("/item/"+e+"?from=/news/activity"+this.data.id)},initialize:function(){var t=this;t.shopApi=new s.ActivityAPI({$el:t.$(".hm_shop"),params:{h5name:"api_prod"+this.data.id},success:function(e){t.set({activity:e.data}),"H"==t.data.type&&o.bind(t.$(".hm_shop_scroll:not(.s_binded)").addClass("s_binded"),{vScroll:!1,hScroll:!0})}}),t.shopApi.load()}});i.exports=a});define("components/share",["$","core/view","core/model3","bridge"],function(t,e,i){var r=(t("$"),t("core/view")),s=t("core/model3"),o=t("bridge"),a=r.extend({events:{"tap .js_weixin_timeline":function(){o.wx({type:"shareLinkURL",linkURL:this.model.data.linkURL,tagName:"abs",title:this.model.data.title,description:this.model.data.description,scene:1},function(t){self.callback(t)})},"tap .js_weixin_session":function(){o.wx({type:"shareLinkURL",linkURL:this.model.data.linkURL,tagName:"abs",title:this.model.data.title,description:this.model.data.description,scene:0},function(t){self.callback(t)})},"tap .js_qq":function(){o.qq({type:"shareLinkURL",linkURL:this.model.data.linkURL,title:this.model.data.title,description:this.model.data.description},function(t){self.callback(t)})},"tap .js_cancel":function(){this.hide()},tap:function(t){t.target==this.el&&this.hide()}},el:'<div class="cp_share_mask" style="display:none"> <div class="cp_share"> <div class="hd">{{head}}</div> <div class="bd"> <ul> <li class="js_weixin_timeline"><span>朋友圈</span></li> <li class="js_weixin_session"><span>微信</span></li> <li class="js_qq"><span>QQ</span></li> </ul> </div> <div class="ft"><b class="btn js_cancel">取消</b></div> </div> </div>',callback:function(){},initialize:function(){this.model=new s.ViewModel(this.$el,this.options)},set:function(t){return this.model.set(t),this},show:function(){return this.$el.show(),this},hide:function(){return this.$el.hide(),this}});i.exports=a});define("components/confirm",["$","core/model3"],function(t,e,i){var n=t("$"),r=t("core/model3"),s=r.ViewModel.extend({el:'<div class="cp_mask" style="display:none"> <div class="cp_confirm" style="height:{{height}}px;margin-top:-{{height/2}}px"> <div class="cp_confirm_bd" sn-html="{{content}}"></div> <div class="cp_confirm_ft"><b class="btn" sn-tap="this.cancel">取消</b><b class="btn js_confirm"  sn-tap="this.confirm">确定</b></div> </div> </div>',cancel:function(t){this.hide();var e=this.get("cancel");e&&e.call(this,t)},confirm:function(t){this.hide();var e=this.get("confirm");e&&e.call(this,t)},initialize:function(){this.listenTo(this.$el,n.fx.transitionEnd,this._hide)},show:function(){this.$el.show().addClass("show"),this.set({height:this.$(".cp_confirm")[0].offsetHeight})},_hide:function(){!this.$el.hasClass("show")&&this.$el.hide()},hide:function(){this.$el.removeClass("show")}});i.exports=s});define("components/deletion",["$","core/touch2","core/event"],function(t,e,n){var i=t("$"),r=t("core/touch2"),s=t("core/event"),o=function(t){var e=this,n=t.events;!t.width&&(t.width=80),this.$mask=i('<div style="position:absolute;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0);display:none;z-index:3000"></div>').appendTo("body").on("touchend",function(t){var r=t.changedTouches[0];if(e.$mask.hide(),e.touch.scrollTo(0,0,200),!this._cancel){var o=document.elementFromPoint(r.pageX,r.pageY),a=e.$target[0].parentNode;if(n&&(a==o||i.contains(a,o)))for(var l in n)for(var c=o;c!=a.parentNode;c=c.parentNode)if(i(c).is(l))return n[l].call(e,s.createEvent("tap",{currentTarget:c,target:o})),!1}}).on("touchstart",function(){this._cancel=!1}).on("touchmove",function(){this._cancel=!0}),this.touch=new r(t.el,{enableVertical:!1,enableHorizontal:!0,children:t.children}),this.touch.on("start",function(n){e.$target=i(n.currentTarget),this.maxX=t.width,this.minX=0}).on("move",function(t){e.$target.css({"-webkit-transform":"translate(-"+this.x+"px,0px)"})}).on("end",function(){console.log("end"),e.$mask.show()}).on("stop",function(){this.x!=t.width&&this.scrollTo(t.width,0,50)})};o.prototype=Object.create(s),n.exports=o});define("components/month",["$","core/model3","models/base","components/size","util"],function(t,e,i){var n=t("$"),s=t("core/model3"),r=t("models/base"),o=t("components/size"),a=t("util"),l=s.ViewModel.extend({el:'<div class="main"><div class="uc_month_get" style="margin-bottom:10px"> <ul class="list"> <li sn-repeat="item in month"><img src="{{item.WPP_LIST_PIC}}"> <p class="con"> <span class="name">{{item.PRD_NAME}}</span> <em>￥{{item.PRD_PRICE}}</em> <del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del> <b class="btn" sn-tap="this.showSize(item)">免费领取</b> </p></li> </ul> <ul class="sp_list" style="overflow:hidden"> <li sn-repeat="item in data" class="sp_list_item" data-forward="/item/{{item.PRD_ID}}?from={{url}}" sn-index="0"> <img src="{{item.WPP_LIST_PIC}}"> <p class="price"><b>￥{{item.PRD_PRICE}}</b><del sn-display="{{item.PRD_PRICE!=0&&item.PRD_PRICE<item.PRD_MEMBER_PRICE}}" style="display: none;">￥{{item.PRD_MEMBER_PRICE}}&nbsp;</del></p> <p class="name">{{item.PRD_NAME}}</p> </li> </ul> </div></div>',showSize:function(t,e){this.colorAndSpec.setParam({id:e.PRH_ID}).load(),this.size.set({data:e}).show()},initialize:function(){var t=this;t.set({url:encodeURIComponent(location.hash)}),t.size=new o,t.size.$el.appendTo(n("body"));var e=new r.MonthAPI({$el:t.$el,checkData:!1,params:{freid:this.data.id},success:function(e){for(var i=[],n=0;n<e.data.length;n++)-1==a.indexOf(i,function(t){return t.PRH_ID==e.data[n].PRH_ID})&&i.push(e.data[n]);t.records=e.data,t.set({month:i})}});e.load();var i=new r.MonthProductAPI({$el:t.$el,success:function(e){t.set(e)}});i.load(),t.colorAndSpec=new r.ProductColorAndSpec({$el:t.size.$el,checkData:!1,success:function(e){for(var i=[],n=[],s=0,r=e.data.length;r>s;s++){var o=e.data[s];-1!=a.indexOf(t.records,function(t){return t.PRD_ID==o.PRD_ID})&&(-1==i.indexOf(o.PRD_COLOR)&&i.push(o.PRD_COLOR),-1==n.indexOf(o.PRD_SPEC)&&n.push(o.PRD_SPEC))}var l=t.size.data.data,o=a.first(e.data,function(t){return t.PRD_ID==l.PRD_ID});console.log(e.data),t.size.set({freid:t.data.id,type:"month",color:i,spec:n,colorSpec:e.data,data:o,qty:1})}})}});i.exports=l});define("components/shareOrder",["$","core/model3","components/share"],function(t,e,i){var s=(t("$"),t("core/model3")),r=t("components/share"),o=s.ViewModel.extend({el:'<div class="main"><div class="od_share"> <h1>支付成功</h1> <h2>感谢在ABS购买商品</h2> <div class="con"> <h3>恭喜您获得</h3> <h4>纳米净颜美容巾免费领取兑换券</h4> <h3>赶快呼唤好友来领取吧!</h3> <h5>*分享的礼物券中有3张被好友成功领取，就可以获得<em>500积分</em>（全场通用，可直接抵扣现金）</h5> <div class="btn" sn-tap="this.showShare()">发礼物，抢500积分</div> </div> </div></div>',showShare:function(){this.share.show()},initialize:function(){var t=this;t.share=new r({head:"分享礼物",title:"",linkURL:"http://m.abs.cn/",description:""}),t.share.callback=function(t){},t.share.$el.appendTo(t.$el)}});i.exports=o});define("components/size",["$","core/model3","models/base","util","widget/scroll"],function(t,e,i){var n=t("$"),s=t("core/model3"),r=t("models/base"),a=t("util"),o=t("widget/scroll"),l=s.ViewModel.extend({el:'<div class="pd_size_wrap js_size {{isShowSize?\'\':\'out\'}}" style="display:none" sn-tap="this.tap()"> <div class="pd_size"> <div class="pd_size_close" sn-tap="isShowSize=false"></div> <div class="base_info"> <div class="img"><img src="{{data.WPP_LIST_PIC||data.WPP_M_PIC}}" /></div> <div class="info"> <h2 class="price">¥{{data.PRD_PRICE}}</h2> <div class="qty">库存{{data.PRD_NUM}}件</div> <p class="other"> <em>选择</em> <em>尺码</em> <em>颜色分类</em> </p> </div> </div> <div class="pd_size_con"> <div class="pd_size_select"> <div class="hd">尺码</div> <ul> <li sn-repeat="item in spec" class="{{data.PRD_SPEC==item?\'curr\':\'\'}}" sn-tap="this.setSpec(item)">{{item.split(\'|\')[0]}}</li> </ul> </div> <div class="pd_size_select"> <div class="hd">颜色分类</div> <ul> <li sn-repeat="item in color" class="{{data.PRD_COLOR==item?\'curr\':\'\'}}" sn-tap="this.setColor(item)">{{item}}</li> </ul> </div> </div> <div class="pd_size_buy"> <p class="hd">购买数量</p> <p class="qty"><em sn-tap="qty=Math.max(1,qty-1)">-</em> <input type="text" class="qty" value="{{qty}}" /> <em sn-tap="qty=qty+1">+</em> </p> </div> <b class="btn_large btn_confirm" sn-tap="this.confirm()">{{btn||\'确认\'}}</b> </div> </div>',setSpec:function(t,e){this.set("data.PRD_SPEC",e),this.onChange()},setColor:function(t,e){this.set("data.PRD_COLOR",e),this.onChange()},onChange:function(){var t=this,e=t.get("colorSpec"),i=t.get("data"),n=a.first(e,function(t){return t.PRD_SPEC==i.PRD_SPEC&&t.PRD_COLOR==i.PRD_COLOR});this.trigger("SizeChange",n)},show:function(){this.$el.show(),this.set({isShowSize:!0})},confirm:function(t){var e=this,i=e.get("colorSpec"),n=e.get("data"),s=a.first(i,function(t){return t.PRD_SPEC==n.PRD_SPEC&&t.PRD_COLOR==n.PRD_COLOR});if("package"==this.data.type)this.data.confirm(s,this.data.PST_ID,e.get("qty"));else{if(e.set({data:s}),0===s.PRD_NUM)return void sl.tip("该商品已售罄");e.cartAddAPI.setParam({prd:s.PRD_ID,qty:e.get("qty")}).load()}},hide:function(){this.set({isShowSize:!1})},tap:function(t){n(t.target).hasClass("js_size")&&this.hide()},initialize:function(){var t=this;t.user=a.store("user"),o.bind(t.$(".pd_size_con")),t.listenTo(t.$el,n.fx.transitionEnd,function(e){t.$el.hasClass("out")&&t.$el.hide()}),t.cartAddAPI=new r.CartAddAPI({$el:t.$el,checkData:!1,check:!1,beforeSend:function(){"month"==t.data.type?this.setUrl("/api/prod/addmemberbag").setParam({prdid:t.get("data").PRD_ID,freid:t.get("freid")}):this.setParam({prd:t.get("data").PRD_ID}),t.$(".js_buy").addClass("disabled")},params:{pspcode:t.user.PSP_CODE},success:function(e){e.success?(sl.activity.setResult("CartChange"),sl.tip("加入购物车成功！"),t.hide()):sl.tip(e.msg)},complete:function(){t.$(".js_buy").removeClass("disabled")}})}});i.exports=l});define("components/fastbuy",["$","core/model3","models/base","components/size","util"],function(require,exports,module){var $=require("$"),model=require("core/model3"),api=require("models/base"),Size=require("components/size"),util=require("util"),Month=model.ViewModel.extend({el:'<div class="main"><div class="sp_fastbuy" style="margin-bottom:10px"> <dl sn-repeat="item in data" class="repeat"> <dt><b></b><i>{{util.formatDate(item.time,item.timeLeft?\'MM月dd日 HH:mm\':\'MM月dd日 即将开始\')}}</i><span sn-display="{{item.timeLeft}}">{{item.timeLeft.indexOf(\'-\')!=0?\'还剩\':\'\'}}<em>{{item.timeLeft.indexOf(\'-\')==0?\'已结束\':item.timeLeft}}</em></span></dt> <dd sn-repeat="prod in item.data"> <img src="{{prod.WPP_LIST_PIC}}" sn-tap="this.goto(prod)"> <div class="con"> <span class="name">{{prod.PRD_NAME}}</span> <p class="price"> <del sn-display="{{prod.PRD_PRICE!=0&&prod.PRD_PRICE<prod.PRD_MEMBER_PRICE}}" style="display: none;">￥{{prod.PRD_MEMBER_PRICE}}&nbsp;</del> <em>￥{{prod.PRD_PRICE}}</em> </p> <p class="fast_btn"> <span>仅限<em>{{prod.flp_stock}}</em>件</span> <b class="btn{{!prod.qty||(item.timeLeft&&item.timeLeft.indexOf(\'-\')==0)?\' over\':\'\'}}" sn-tap="this.goto(prod)">{{(item.timeLeft?(item.timeLeft.indexOf(\'-\')!=0?(!prod.qty?\'已抢完\':\'立即抢购\'):\'已结束\'):\'即将开始\')}}</b> </p> </div> </dd> </dl> </div><div class="datanotfound fastbuy_nodata" sn-display="{{!data.length}}"> <h1>FLASH SALE</h1> 每周一上午10:00准点开抢 </div></div>',"goto":function(t,e){var i=this;i.view.forward("/item/"+e.PRD_ID+"?from="+encodeURIComponent(i.view.route.url)),console.log(e)},timeDiff:function(t,e){if(+t>Date.now()||i)return"";var i=+e-Date.now(),n=parseInt(i/864e5);i%=864e5;var s=parseInt(i/36e5);i%=36e5;var r=parseInt(i/6e4);i%=6e4;var a=parseInt(i/1e3);return i%=1e3,(n?n+"天 ":"")+util.pad(s)+":"+util.pad(r)+":"+util.pad(a)},initialize:function(){var self=this;self.user=util.store("user"),self.set({url:encodeURIComponent(location.hash)});var now=new Date,startDt;startDt=1!=now.getDay()?new Date(Date.now()-24*(now.getDay()-1)*60*60*1e3):now;var endDt=new Date(+startDt+6048e5),dataAPI=new api.FastBuyAPI({$el:self.$el,checkData:!1,params:{startdt:util.formatDate(startDt,"yyyy-MM-dd 00:00:00"),enddt:util.formatDate(endDt,"yyyy-MM-dd 23:59:59")},success:function(res){for(var result=[],i=0;i<res.data.length;i++){var item=res.data[i],prod=item.V_PRODUCT1,time=eval("new "+item.flp_start_time.replace(/\//g,"")),endTime=eval("new "+item.flp_end_time.replace(/\//g,"")),strTime=util.formatDate(time),strEndTime=util.formatDate(endTime);if(!(+time>Date.now())){var data=util.first(result,function(t){return t.strTime==strTime&&t.strEndTime==strEndTime}),prodInfo={PRD_ID:prod.PRD_ID,WPP_LIST_PIC:prod.WPP_LIST_PIC,PRD_NAME:prod.PRD_NAME,PRD_PRICE:item.flp_price,PRD_MEMBER_PRICE:prod.PRD_MEMBER_PRICE,flp_stock:item.flp_stock,qty:item.qty};data?data.data.push(prodInfo):result.push({strTime:strTime,strEndTime:strEndTime,timeLeft:self.timeDiff(time,endTime),time:time,endTime:endTime,data:[prodInfo]})}}setInterval(function(){self.getModel("data").each(function(t,e){t.set({timeLeft:self.timeDiff(t.data.time,t.data.endTime)})})},1e3),self.set({data:result})}});dataAPI.load(),self.cartAddAPI=new api.CartAddAPI({$el:self.$el,checkData:!1,check:!1,params:{pspcode:self.user.PSP_CODE},success:function(t){t.success&&sl.tip("加入购物车成功！")},complete:function(){}})}});module.exports=Month});define("components/package",["$","core/model3","models/base","components/size","util"],function(t,e,i){var n=t("$"),s=t("core/model3"),r=t("models/base"),a=t("components/size"),o=t("util"),l=s.ViewModel.extend({el:'<div class="main sp_package"> <div class="sp_package_hd"> <div class="con"> <h1>{{PPG_NAME}}</h1> <div class="text">{{PPG_MEMO}}</div> </div> </div> <div class="sp_package_bd" sn-repeat="item in data"> <div class="hd">{{item.PPS_Model.PST_NAME}} <em>下方商品任选{{item.PPS_Model.PST_OPTIONAL_QTY}}件</em></div> <ul> <li sn-repeat="prod in item.PRD_List"> <img sn-src="{{prod.WPP_LIST_PIC}}" data-forward="/item/{{prod.PRD_ID}}?from={{url}}" /> <div class="name" sn-tap="this.selectSize(item,prod)"> <span>{{prod.PRD_NAME}}</span> <b>选择 尺寸 颜色 ></b> <p class="qty"> <span class="minus">-</span> <input type="text" value="{{prod.qty||1}}" sn-model="changedQty"> <span class="plus">+</span> </p> </div> <p class="price"> <em>￥{{prod.PRD_PRICE}}</em> <del sn-display="{{prod.PRD_PRICE!=0&&prod.PRD_PRICE<prod.PRD_MEMBER_PRICE}}" style="display: none;">￥{{prod.PRD_MEMBER_PRICE}}&nbsp;</del> </p> </li> </ul> </div> </div><div class="sp_package_ft"> <div class="price"> <em>总计：</em><b>¥{{PPG_PRICE}}</b> </div> <div class="buy" sn-tap="this.showList()">查看套餐商品（{{qty||0}}）</div> </div><div class="sp_package_list" sn-tap="this.hideList()" style="display:none"> <div class="sp_package_hd"> 确认套餐清单 </div> <div class="main"> <div class="sp_package_bd" sn-repeat="item in data"> <div class="hd">{{item.PPS_Model.PST_NAME}} <em>任选{{item.PPS_Model.PST_OPTIONAL_QTY}}件</em></div> <ul> <li sn-repeat="prod in item.list"> <img sn-src="{{prod.WPP_LIST_PIC}}" /> <div class="name"> <span>{{prod.PRD_NAME}}</span> </div> <p class="price"> <em>￥{{prod.PRD_PRICE}}</em> <del sn-display="{{prod.PRD_PRICE!=0&&prod.PRD_PRICE<prod.PRD_MEMBER_PRICE}}" style="display: none;">￥{{prod.PRD_MEMBER_PRICE}}&nbsp;</del> </p> <b>尺寸:{{prod.PRD_DISPLAY_SPEC}} 颜色:{{prod.PRD_COLOR}}  x{{prod.qty}}</b> <div class="btn" sn-tap="this.deleteItem(prod,item.PPS_Model.PST_ID)">删除</div> </li> </ul> </div> </div> <div class="sp_package_ft"> <div class="buy" sn-tap="this.buy()">加入购物车</div> </div> </div>',deleteItem:function(t,e,i){this.getModel("data").each(function(t,n){var s=t.get("PPS_Model");return s.PST_ID==i?(t.getModel("list").remove(o.indexOf(t.data.list,function(t){return t.PRD_ID==e.PRD_ID})),!1):void 0}),this.refreshQty()},refreshQty:function(){for(var t=this,e=0,i=0;i<t.data.data.length;i++)for(var n=t.data.data[i],s=0;n.list&&s<n.list.length;s++)e+=n.list[s].qty;t.set({qty:e})},_hideList:function(){this.$(".sp_package_list").hide()},showList:function(){this.$(".sp_package_list").show()},hideList:function(t){n(t.target).hasClass("sp_package_list")&&this._hideList()},selectSize:function(t,e,i){for(var n=this,s=[],r=[],o=(this.data.data,0),l=e.PRD_Lis.length;l>o;o++){var c=e.PRD_Lis[o];c.PRD_SPEC=c.PRD_DISPLAY_SPEC,-1==s.indexOf(c.PRD_COLOR)&&s.push(c.PRD_COLOR),-1==r.indexOf(c.PRD_DISPLAY_SPEC)&&r.push(c.PRD_DISPLAY_SPEC)}i.PRD_SPEC=i.PRD_DISPLAY_SPEC,n.size.set({PST_ID:e.PPS_Model.PST_ID,type:"package",color:s,spec:r,colorSpec:e.PRD_Lis,data:i,qty:1}).show()},buy:function(t,e){var i=this;if(!this.data.qty)return void sl.tip("请选择套餐商品");for(var s,n="",r=0;r<i.data.data.length;r++){var a=i.data.data[r];if(s=a.PPG_ID,n+=a.PPS_Model.PST_ID+"-",!a.list)return void sl.tip("请选择分组商品");for(var o=0;o<a.list.length;o++)for(var l=0;l<a.list[o].qty;l++)n+=a.list[o].PRD_ID+",";n+="|"}i.cartAddAPI.setParam({ppgId:s,prdIds:n}).load()},initialize:function(){var t=this;t.user=o.store("user"),t.set({url:encodeURIComponent(location.hash)}),t.size=new a({btn:"选择商品",confirm:function(e,i,s){t.getModel("data").each(function(t,r){var a=t.get("PPS_Model");if(a.PST_ID==i){var o=a.PST_OPTIONAL_QTY,l=t.get("list");l=l?[].concat(l):[];for(var c=0,h=0;h<l.length;h++)c+=l[h].qty;return c+s>o?(sl.tip("您选择的商品数量超过该组指定数量"),!1):(l.push(n.extend({},e,{qty:s})),t.set({list:l}),!1)}}),t.refreshQty(),t.size.hide()}}),t.size.$el.appendTo(n("body"));var e=new r.PackageAPI({$el:t.$(".sp_package"),params:{id:this.data.id},success:function(e){console.log(e.data);var i=e.data[0];t.set({PPG_MEMO:i.PPG_MEMO,PPG_NAME:i.PPG_NAME,PPG_PRICE:i.PPG_PRICE,data:e.data})}});e.load(),t.cartAddAPI=new r.PackageCartAPI({$el:t.$el,checkData:!1,check:!1,params:{pspcode:t.user.PSP_CODE},success:function(t){t.success?sl.tip("加入购物车成功！"):sl.tip(t.msg)},complete:function(){t._hideList()}})}});i.exports=l});define("components/banner",["$","core/model3","models/base","components/size","util"],function(t,e,i){var s=(t("$"),t("core/model3")),o=(t("models/base"),t("components/size"),t("util")),l=s.ViewModel.extend({el:'<div class="main banner2"> <img src="http://appuser.abs.cn/dest/images/banner.jpg" /> <div class="banner2_text"> 1.本次活动仅限新用户参与，每手机账号限领取一次礼物兑换券。<br /> 2.礼物兑换券可在“我的卡券”中查看，凭券可兑换纳米净颜美容巾1条。（商品加入购物车-去结算-选择优惠券-点击购买）<br /> 3.请在礼物兑换券有效期内及时兑换，逾期作废。<br /> 4.本次活动商品数量有限，领完即止。<br /> *本活动最终解释权归上海爱彼此家居用品股份有限公司所有。<br /> </div> </div>',initialize:function(){var t=this;t.user=o.store("user"),t.set({url:encodeURIComponent(location.hash)})}});i.exports=l});define("models/base",["widget/loading"],function(t,e,n){var i=t("widget/loading"),r=i.extend({baseUri:$('meta[name="api-base-url"]').attr("content")});e.API=r,e.OrderStatusAPI=r.extend({url:"/api/user/get_order_status",checkData:!1,check:!1,params:{id:0}}),e.CouponStatusAPI=r.extend({url:"/api/user/get_coupon_status",checkData:!1,check:!1,params:{id:0}});var s=i.extend({baseUri:$('meta[name="shop-api-base-url"]').attr("content"),KEY_PAGE:"currentpage"});e.ShopAPI=s,e.AddressListAPI=s.extend({url:"/api/user/addresslist",params:{pspcode:0}}),e.EditAddressAPI=s.extend({url:"/api/user/editaddress",params:{pspcode:0,edittype:2,mbaId:0,mbaName:"",mbaMobile:0,mbaCtyId:0,mbaDefault:!1,mbaRegId:0,mbaAddress:""}}),e.DeleteAddressAPI=s.extend({url:"/api/user/deladdress",params:{pspcode:0,mbaId:0}}),e.ProvinceAPI=s.extend({url:"/api/user/prvlist"}),e.CityAPI=s.extend({url:"/api/user/ctylist",params:{prvId:0}}),e.RegionAPI=s.extend({url:"/api/user/reglist",params:{ctyId:0}}),e.CouponAPI=s.extend({url:"/api/user/GetCoupon",params:{pspcode:"",csvcode:""}}),e.AvailableCouponAPI=s.extend({url:"/api/prod/availablecoupon",params:{pspcode:""}}),e.GetSharedCouponAPI=r.extend({url:"/api/user/get_shared_coupon",params:{UserID:0,Auth:"",data:""}}),e.CouponUserAPI=r.extend({url:"/api/user/get_coupon_user",params:{data:""}}),e.CreateOrderAPI=s.extend({url:"/api/shop/CreateMOrder",params:{pspcode:"",mba_id:1,pay_type:1,coupon:"",points:0,freecoupon:""}}),e.CategoryAPI=s.extend({url:"/api/prod/pcglist"}),e.SubCategoryAPI=s.extend({url:"/api/prod/pcgitem",params:{id:0}}),e.ProductSearchAPI=s.extend({url:"/Prod/productlist",params:{keycodes:"",orderbyStr:2,orderby:"desc",length:2,pages:0}}),e.ProductHeadAPI=s.extend({url:"/api/prod/prhitem",params:{id:0}}),e.ProductAPI=s.extend({url:"/api/prod/prditem",params:{id:0}}),e.ProductColorAndSpec=s.extend({url:"/api/prod/getsizebyprh",params:{id:0}}),e.ProductDetailAPI=s.extend({url:"/api/prod/prddetail",params:{id:0}}),e.ProductListAPI=s.extend({url:"/api/prod/pcgprd",params:{pcgid:0}}),e.NewProductAPI=s.extend({url:"/api/prod/newproductlist",params:{length:100,pages:0}}),e.ActivityAPI=s.extend({url:"/Prod/GetApiBannerPrd",params:{h5name:"api_prod1"}}),e.CartAPI=s.extend({url:"/api/shop/bag",params:{pspcode:0}}),e.CartQtyAPI=s.extend({url:"/api/shop/bagqty",params:{pspcode:0}}),e.CartAddAPI=s.extend({url:"/api/shop/addbag",params:{pspcode:0,prd:0,qty:1}}),e.CartModifyAPI=s.extend({url:"/api/shop/SaveProductChangeRow",params:{pspcode:0,spbId:0,qty:1}}),e.CartDeleteAPI=s.extend({url:"/api/shop/deletebag",params:{pspcode:0,spbId:0}}),e.CartDeletePackageAPI=s.extend({url:"/api/shop/deletepackagebag",params:{pspcode:0,wacid:0,ppgid:0,groupid:0}}),e.CancelOrderAPI=s.extend({url:"/shop/cancelOrder",params:{pspcode:"",purcode:""}}),e.OrderCreateAPI=s.extend({url:"/api/shop/CreateMOrder",params:{pspcode:"",mba_id:0,pay_type:1,coupon:"",points:0,freecoupon:""}}),e.WxPayAPI=r.extend({url:"/api/shop/wxpayqrcode",checkData:!1,params:{order_no:""}}),e.StewardListAPI=s.extend({url:"/api/steward/list",params:{pspid:0}}),e.StewardQtyAPI=s.extend({url:"/api/steward/stewardqty",params:{pspcode:""}}),e.StewardAPI=s.extend({url:"/api/steward/item",params:{prh_id:0}}),e.StewardDetailAPI=s.extend({url:"/api/steward/detail",params:{detail_id:0}}),e.MonthAPI=s.extend({url:"/api/prod/freeskulist",params:{freid:2}}),e.MonthProductAPI=s.extend({url:"/api/prod/ajaxactprdlist",params:{pages:1,len:6}}),e.FastBuyAPI=s.extend({url:"/api/prod/flashprodlist",params:{startdt:"2015-01-01",enddt:"2016-01-01"}}),e.PackageAPI=s.extend({url:"/api/prod/getpackage",params:{id:0}}),e.PackageCartAPI=s.extend({url:"/api/prod/addpackagebag",params:{pspcode:"",prdIds:"",ppgId:""}}),e.PackageRelativeAPI=s.extend({url:"/api/prod/getppginfo",params:{prdId:""}})});define("models/user",["models/base","core/model3","util","$"],function(t,e,n){var i=t("models/base"),r=t("core/model3"),s=t("util"),o=t("$"),a=r.State,l={get:function(){var t=a.get("user");return t||(t=s.store("user"),t&&a.set("user",t)),t},set:function(t){return null!=t&&(t=o.extend({},l.get(),t)),s.store("user",t),a.set("user",t),this},setParam:function(t){return c.setParam(t),this},request:function(t){var n=this.get();return c.setParam({UserID:n.ID,Auth:n.Auth}).load(t),this}},c=new i.API({el:"body",url:"/api/user/get",checkData:!1,success:function(t){t.success&&l.set(t.data)},error:function(){}});n.exports=l});define("core/model3",["$","util","./base","./event","./component"],function(t,e,n){var i=t("$"),r=t("util"),o=(t("./base"),t("./event")),a=t("./component"),u=/^((-)*\d+|true|false|undefined|null|'(?:\\'|[^'])*')$/,h=/([a-zA-Z_0-9]+)(?:\s*,(\s*[a-zA-Z_0-9]+)){0,1}\s+in\s+([a-zA-Z_0-9]+(?:\.[a-zA-Z_0-9]+){0,})(?:\s*\|\s*filter\s*\:\s*(.+?)){0,1}(?:\s*\|\s*orderBy\:(.+)){0,1}(\s|$)/,p=/\{\{(.+?)\}\}/g,d=/'(?:\\'|[^'])*'|\/\*[\S\s]*?\*\/|\/(?:\\\/|[^\/\r\n])+\/[img]*(?=[\)|\.|,])|\/\/.*|\bvar\s+[_,a-zA-Z0-9]+\s*\=|(^|[\!\=\>\<\?\s\:\(\),\%&\|\+\-\*\/\[\]]+)([\$a-zA-Z_0-9]+(?:\.[a-zA-Z_0-9]+)*(?![a-zA-Z_0-9]*\())/g,f=/([a-zA-Z_0-9]+(?:\.[a-zA-Z_0-9]+)*)\s*=\s*((?:\((?:'(?:\\'|[^'])*'|[^\)])+\)|'(?:\\'|[^'])*'|[^;])+?)(?=\;|\,|$)/g,m=/\b(this\.[\.\w]+\()((?:'(?:\\'|[^'])*'|[^\)])*)\)/g,g=function(t){for(var e=t.split("."),n=[],i="",r=0;r<e.length;r++)n[r]=(0==r?"$data":n[r-1])+"."+e[r];for(var r=0;r<n.length;r++)i+=(r?"&&":"")+n[r]+"!==null&&"+n[r]+"!==undefined";return"(("+i+")?"+t+':"")'},v=function(t,e){for(var n=t.length?t:[t],i=0,r=n.length;r>i;i++){var s=n[i];e(s,i,n),1==s.nodeType&&s.childNodes.length&&v(s.childNodes,e)}},y={contains:function(t,e){return-1!=t.indexOf(e)},like:function(t,e){return-1!=t.indexOf(e)||-1!=e.indexOf(t)},util:r,closestModelData:function(t,e){for(t=t.parentNode;null!=t;t=t.parentNode)if(t.repeat&&(!e||t.repeat.repeat.alias==e))return t.model.data}},x=function(t,e,n,r){if(t instanceof x)this.key=t.key?t.key+"."+e:e;else{if(!(t instanceof A))throw new Error("Model's parent mast be Collection or Model");this.key=t.key+"^child"}if(this.type=i.isPlainObject(n)?"object":"value",t.data[e]=this.data="object"==this.type?i.extend({},n):n,this._key=e,this.model={},this.parent=t,this.root=t.root,r)for(var s=0,o=r.length;o>s;s++)r[s].add(this);this.set(n)},_={getModel:function(t){if("string"==typeof t&&-1!=t.indexOf(".")&&(t=t.split(".")),i.isArray(t)){var e=this;if("this"==t[0]){for(var n=1,r=t.length;r>n;n++)if(!(e=e[t[n]]))return null}else for(var n=0,r=t.length;r>n;n++)if(e instanceof x)e=e.model[t[n]];else{if(!(e instanceof A))return null;e=e.models[t[n]]}return e}return"this"==t?this:""==t?this.data:this.model[t]},get:function(t){var e=this.getModel(t);return e instanceof x||e instanceof A?e.data:e},cover:function(t,e){return this.set(!0,t,e)},set:function(t,e,n){var s,a,c,r=this,l=r.model;if(t!==!0&&(n=e,e=t,t=!1),i.isPlainObject(e))a=e;else if(null===e)!t&&(t=!0),a={};else{if("undefined"==typeof n)return n=e,e="",c=this.parent,c.data[c instanceof A?c.models.indexOf(this):this._key]=n,this.data=n,this._triggerChangeEvent(this.key);(a={})[e]=n}if(i.isPlainObject(this.data)||(this.data={}),t)for(var u in this.data)void 0===a[u]&&(a[u]=null);i.extend(!0,this.data,a);for(var u in a)if(s=l[u],value=a[u],s!==value){var h=u.split(".");if(h.length>1){e=h.pop(),l=this;for(var f,p=0,d=h.length;d>p;p++)if(u=h[p],f=l,l instanceof x)l=l.model[u],l||(l=f.model[u]=new x(f,u,null));else if(l instanceof A&&(l=l.models[u],!l))throw new Error("[Collection index is bigger than length!]");l.set(e,value)}else if(s instanceof x)null===value||void 0===value?s.clear():s.set(value);else if(s instanceof A){if(!i.isArray(value)){if(null!=value)throw new Error("[Array to "+typeof value+" error]不可改变"+u+"的数据类型");value=[]}s.set(value)}else i.isPlainObject(value)?l[u]=new x(this,u,value):i.isArray(value)?l[u]=new A(this,u,value):(l[u]=value,this._triggerChangeEvent(this.key?this.key+"/"+u:u,s,value))}return this._triggerChangeEvent(this.key),r},_triggerChangeEvent:function(t,e,n){return this.root.init||this.root.trigger("change"+(t?":"+t:"").replace(/\./g,"/"),this,e,n),this},clear:function(){var t={};for(var e in this.data)t[e]=null;this.set(t)},closest:function(t){for(var e=this.parent;null!=e;e=e.parent)if(e.key==t)return e},contains:function(t,e){for(t=t.parent;null!=t;t=t.parent){if(t==this)return!0;if(e&&t instanceof A)return!1}return!1},_bubbleEl:function(t,e,n){for(;t&&(t._repeatNode&&(t=t._repeatNode),t.model&&t.repeat);){if(void 0!==(val=e(t)))return val;t=t.repeat.repeatNode}return void 0===n?this:n},isUnderRoot:function(){for(var t=this;null!=t;t=t.parent)if(t instanceof A)return!1;return!0},isRelativeToEl:function(t){var e=this,n=this.isUnderRoot();return n?!0:e._bubbleEl(t,function(t){return t.model==e||t.model.contains(e,!0)?!0:void 0},!1)}};_.reset=_.clear,x.prototype=i.extend(Object.create(o),_);var b=function(t){i.extend(this,t);for(var e=this,n=this.collectionName.split("."),r=this.parent;r;){if(r.alias==n[0]){n[0]=r.collectionName+"^child",this.collectionName=n.join("."),this.isChild=!0;break}r=r.parent}var s=document.createComment(this.collectionName);if(s.repeat=this,this.replacement=s,this.el.parentNode.insertBefore(s,this.el),this.el.parentNode.removeChild(this.el),this.collectionRepeats=[],this.filters){var o=this.viewModel._compile("{{"+this.filters+"}}",this,function(t,n){for(var i=n.isUnderRoot(),r=0;r<e.collectionRepeats.length;r++){var s=e.collectionRepeats[r];(i||n.parent==s.collection||n.contains(s.collection))&&s.update()}});this.filter=this.viewModel._attrId(),this.viewModel._fns.push(o)}},w=function(t,e,n){var i=this;if(this.collection=t,this.repeat=e,this.parentModel=n,e.collectionRepeats.push(this),e.parent)if(e.isChild||n)this.type="children",this.replacement=this.findReplacement(n||t.parent),this.repeatNode=this.replacement._repeatNode;else{this.type="inset",this.children=[];for(var r=0;r<e.parent.collectionRepeats.length;r++){var s=e.parent.collectionRepeats[r];s.collection.on("add",function(n,r){for(var s=new w(t,e,r),o=0;o<t.models.length;o++)s.add(t.models[o]);i.children.push(s),s.update()}).on("remove",function(t,e){for(var n=i.children.length-1;n>=0;n--)for(var r=i.children[n].parentModel,s=e.length-1;s>=0;s--)if(r==e[s]){i.children.splice(n,1);break}}).each(function(n){i.children.push(new w(t,e,n))}),s.children.push(this)}}else this.type="normal",this.replacement=e.replacement;this.el=this.cloneNode(e.el),this.elements=[]};w.prototype={findReplacement:function(t){for(;null!=t&&t!=t.root;t=t.parent)if(t instanceof x&&t.replacement)for(var e=0;e<t.replacement.length;e++)if(t.replacement[e].repeat==this.repeat)return t.replacement[e]},_removeEl:function(t){v(i(t).remove(),function(t,e,n){if(t._origin){for(var i=t._origin._elements,e=i.length-1;e>=0;e--)if(i[e]==t){i.splice(e,1);break}}else if(8==t.nodeType&&t.repeat&&t._replacement)for(var e=t._replacement.length-1;e>=0;e--)if(t._replacement[e]==t){t._replacement.splice(e,1);break}})},update:function(){if("inset"!=this.type){var n=document.createDocumentFragment(),i=0,r=this.elements,s=this.repeat,o=s.orderBy,a=this.collection.root;o&&r.sort(function(t,e){return t=t.model.data[o],e=e.model.data[o],t>e?1:e>t?-1:0});for(var t=0,e=r.length;e>t;t++){var l=r[t];void 0===s.filter||a.fns[s.filter].call(a,y,l.model,this.replacement)?(n.appendChild(l),l.setAttribute("sn-index",i),s.indexAlias&&(l.setAttribute("sn-index-alias",s.indexAlias),a._triggerChangeEvent(s.collectionName+"/"+s.alias+"/"+s.indexAlias,l.model)),i++):l.parentNode&&l.parentNode.removeChild(l)}this.replacement.parentNode.insertBefore(n,this.replacement)}else for(var t=0,e=this.children.length;e>t;t++)this.children[t].update()},cloneNode:function(t,e,n,i){var s,r=t.cloneNode(!1);if(t==this.el?(r.repeat=this,r.model=e,i=r):r._repeatNode=i,n&&n.appendChild(r),8==t.nodeType&&t.repeat)r.repeat=t.repeat,e&&((e.replacement||(e.replacement=[])).push(r),r._replacement=e.replacement);else if(t.bindings&&(r.bindings=t.bindings,e?(r._origin=t._origin,t._origin._elements.push(r),e.root._setElAttr(r)):r._origin=t),1==t.nodeType&&(s=t.childNodes.length))for(var o=0;s>o;o++)this.cloneNode(t.childNodes[o],e,r,i);return r},"do":function(t){if("inset"==this.type)for(var e=0;e<this.children.length;e++)this.children[e]["do"](t);else t.call(this);return this},each:function(t,e,n){return"function"!=typeof e&&(n=e,e=null),this["do"](function(){for(var i=this.elements.length-1,r=i;r>=0;r--){var s=n?r:i-r;if(t.call(this,s,this.elements[s])===!1)break}e&&e.call(this)})},remove:function(t,e){return this["do"](function(n,i){if("function"==typeof t)for(var n=this.elements.length-1;n>=0;n--){var i=this.elements[n];t(i,n)&&(this.elements.splice(n,1),this._removeEl(i))}else this.elements.splice(t,e||1).forEach(function(t){this._removeEl(t)}.bind(this))})},add:function(t){return this["do"](function(){this.elements.push(this.cloneNode(this.el,t))})},clear:function(){return this.each(function(t,e){e.parentNode.removeChild(e)},function(){this.elements.length=0},!0)}};var A=function(t,e,n){var i;if(this.models=[],this.parent=t,this.key=t.key?t.key+"."+e:e,this._key=e,this.root=t.root,this.repeats=[],i=t.root.repeats[this.key])for(var r=0;r<i.length;r++)this.repeats.push(new w(this,i[r]));this.data=[],t.data[e]=this.data,this.add(n)};A.prototype=Object.create(o),A.prototype.each=function(t){for(var e=0;e<this.models.length&&t.call(this,this.models[e],e)!==!1;e++);return this},A.prototype.find=function(t){for(var e=0;e<this.models.length;e++)if(t.call(this,this.data[e],e))return this.models[e];return null},A.prototype.add=function(t){var e,n;i.isArray(t)||(t=[t]);for(var r=0,s=t.length;s>r;r++){var o=t[r];n=this.models.length,e=new x(this,n,o,this.repeats),this.models.push(e),this.trigger("add",e)}for(var r=0,a=this.repeats.length;a>r;r++)this.repeats[r].update();this._triggerChangeEvent()},A.prototype._triggerChangeEvent=function(){this._silent||this.root._triggerChangeEvent(this.key,this,this.data)._triggerChangeEvent(this.key+"/length",this,this.data.length)},A.prototype.remove=function(t,e){var n;if("function"==typeof t){n=[];for(var i=this.models.length-1;i>=0;i--)t.call(this,this.models[i],i)&&(n.push(this.models.splice(i,1)[0]),this.data.splice(i,1));for(var i=0,r=this.repeats.length;r>i;i++)this.repeats[i].remove(function(t){return-1!=n.indexOf(t.model)})}else{e||(e=1),n=this.models.splice(t,e),this.data.splice(t,e);for(var i=0,r=this.repeats.length;r>i;i++)this.repeats[i].remove(t,e)}this._triggerChangeEvent(),this.trigger("remove",n)},A.prototype.clear=function(t){this.models.length=this.data.length=0;for(var e=0,n=this.repeats.length;n>e;e++)this.repeats[e].clear();this._triggerChangeEvent()},A.prototype.set=function(t){if(this._silent=!0,t&&0!=t.length){var e=this.models.length;t.length<e&&this.remove(t.length,e-t.length);var n=0;this.each(function(e){e.set(!0,t[n]),n++}),this.add(0==n?t:t.slice(n,t.length))}else this.clear();return this._silent=!1,this._triggerChangeEvent(),this},A.prototype.get=function(t){return this.models[t]};var E=["tap","click","change","focus","blur","transition-end"],$=["this","$","Math","new","Date","encodeURIComponent","window","document"],T=function(t,e){var n="var $el=$(el),root=model.root,$data=$.extend({},global,root.data,{$state:root.$state.data}";if(t){n+=",{";for(var i=t.parent,r=t;null!=i;r=i,i=i.parent)n+=i.alias+":"+(r.isChild?"model.closest('"+i.collectionName+"^child').data":'global.closestModelData(el,"'+i.alias+'")')+",",i.indexAlias&&(n+=i.indexAlias+":$el.closest('[sn-index-alias=\""+i.indexAlias+'"]\').attr("sn-index"),');n+=t.alias+":model.data",t.indexAlias&&(n+=","+t.indexAlias+":$el.closest('[sn-index-alias=\""+t.indexAlias+'"]\').attr("sn-index")'),n+="}"}return n+=");with($data){"+e+"}"},k=function(t,e){"undefined"!=typeof e||void 0!=t&&!i.isPlainObject(t)||(e=t,t=this.el),this.cid=r.guid(),this._bindListenTo=[],this.data=i.extend({},e),this.model={},this.repeats={},this._fns=[],this.fns=[],this.root=this,t&&this.bind(t),this.init=!0,this.set(this.data),this.init=!1,this.on("Destroy",this.onDestroy),this.initialize.call(this,arguments)};k.prototype=i.extend(Object.create(x.prototype),{key:"",initialize:r.noop,setState:function(t,e,n){return this.$state.set(t,e,n),this},getState:function(t){return this.$state.get(t)},_compile:function(t,e,n){var r,i=this,s="try{return '"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(p,function(t,s){return"'+("+s.replace(/\\\\/g,"\\").replace(/\\'/g,"'").replace(d,function(t,s,o){if(!o)return 0==t.indexOf("var ")?t.replace(/var\s+([^\=]+)=/,function(t,e){return r=(r||[]).concat(e.split(",")),e+"="}):t;var a=o.split("."),l=a[0];if("$state"==l)return i.$state.on("change:"+o.replace("$state.","").replace(/\./g,"/"),n),s+o;if(!l||y[l]||-1!=$.indexOf(l)||r&&-1!=r.indexOf(l)||u.test(o))return s+o;var c;if(e)for(var h=e;null!=h;h=h.parent){if(l==h.alias){a[0]=h.collectionName+"^child";break}if(l==h.indexAlias){c=h;break}}var p=c?c.collectionName+"/"+c.alias+"/"+c.indexAlias:a.join("/").replace(/\./g,"/");return i.on("change:"+p,n),s+g(o)})+")+'"})+"';}catch(e){return '';}",o="function(global,model,el){"+T(e,(r&&r.length?"var "+r.join(",")+";":"")+s.replace("return ''+","return ").replace(/\+\'\'/g,""))+"}";return o},_setElAttr:function(t,e){var n=this;if(t.bindings){e?[e]:t.bindings;for(var e in t.bindings){var s=n.fns[t.bindings[e]].call(n,y,n._closestByEl(t),t);switch(e){case"textContent":t.textContent!==s+""&&(t.textContent=s);break;case"value":"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName?t.value!=s&&(t.value=s):t.setAttribute(e,s);break;case"html":case"sn-html":t.innerHTML=s;break;case"display":case"sn-display":t.style.display=r.isFalse(s)?"none":"block"==s||"inline"==s||"inline-block"==s?s:"";break;case"sn-style":case"style":t.style.cssText+=s;break;default:t.setAttribute(e,s)}}}},_bindAttr:function(t,e,n,i){var r=this;if(p.test(n)){var s=function(n,s){if(i)for(var o=0;o<t._elements.length;o++){var a=t._elements[o];(s==this||s.isRelativeToEl(a))&&r._setElAttr(a,e)}else r._setElAttr(t,e)};(t.bindings||(t._elements=[],t.bindings={}))[e]=r._attrId(),r._fns.push(r._compile(n,i,s))}},_closestByEl:function(t){return this._bubbleEl(t,function(t){return t.model})},_getByEl:function(t,e){var n=this,i=e.split("."),r=i[0];return"this"==r?n:"$state"==r?n.$state:this._bubbleEl(t,function(t){return t.repeat.repeat.alias==r?t.model:void 0})},_getVal:function(t,e){var t=t==this||t instanceof x?t:this._getByEl(t,e);return t.get(t==this?e:e.replace(/^[^\.]+\./,""))},_setByEl:function(t,e,n){var i=this._getByEl(t,e);i.set(i==this||i==self.$state?e:e.replace(/^[^\.]+\./,""),n)},_attrId:function(){return this.fns.length+this._fns.length},$:function(t){return this.$el.filter(t).add(this.$el.find(t))},bind:function(t){var e=this,n=[],r=i(t).on("input change","[sn-model]",function(t){if(1!=t._stopModelEvent){var n=t.currentTarget,i=n.getAttribute("sn-model");e._setByEl(n,i,n.value),t._stopModelEvent=!0}}).each(function(){this.snViewModel=e.cid,this.model=e});e.$el=e.$el?e.$el.add(r):r,v(r,function(t,i,r){if(1==t.nodeType){var s=t.getAttribute("sn-repeat");if(null!=s){var o=s.match(h),a=o[3],l=0==a.indexOf("$state")?e.$state:e;s=new b({root:e,viewModel:l,parent:r.repeat,alias:o[1],indexAlias:o[2],collectionName:a,filters:o[4],orderBy:o[5],el:t}),(l.repeats[s.collectionName]||(l.repeats[s.collectionName]=[])).push(s)}else s=r.repeat;s&&(t.childNodes.repeat=s);for(var c=t.attributes.length-1;c>=0;c--){var u=t.attributes[c].name,p=t.attributes[c].value;if(p)if("sn-error"==u?u="onerror":"sn-src"==u&&(u="src"),"sn-display"==u||"sn-html"==u||"sn-style"==u||0!=u.indexOf("sn-"))0==u.indexOf("sn-")&&-1==p.indexOf("{{")&&-1==p.indexOf("}}")&&(p="{{"+p+"}}"),e._bindAttr(t,u,p,s);else if(-1!=E.indexOf(u.replace(/^sn-/,"")))if(t.removeAttribute(u),u+=e.cid+"-",f.test(p)||m.test(p)){var d=p.replace(m,function(t,e,n){return e+"e"+(n?",":"")+n+")"}).replace(f,'this._setByEl(e.currentTarget,"$1",$2)'),g="function(e,model,global){var el=e.currentTarget;"+T(s,d)+"}";t.setAttribute(u,e._attrId()),e._fns.push(g)}else t.setAttribute(u,p)}!s&&t.bindings&&n.push(t)}else 3==t.nodeType&&(e._bindAttr(t,"textContent",t.textContent,r.repeat),!r.repeat&&t.bindings&&n.push(t))});for(var a,l,s=function(t){if(1!=t._stopModelEvent){var r,s,n=t.currentTarget,i=n.getAttribute("sn-"+t.type+e.cid+"-");if("false"==i)return!1;if(/^\d+$/.test(i)){var o=e._closestByEl(n);o.root===e&&e.fns[i].call(e,t,o,y)}else{for(var a=[t],c=i.split(":"),u=0;u<c.length;u++){var h=c[u];0==u?(s=e._getByEl(n,h),r=e._getVal(s,h),t.model=e._closestByEl(n,h)):a.push(e._getVal(n,h))}r.apply(s,a)}t._stopModelEvent=!0}},o=0;o<E.length;o++)a="transition-end"==E[o]?i.fx.transitionEnd:E[o],l="[sn-"+E[o]+e.cid+"-]",r.on(a,l,s).filter(l).on(a,s);this.fns=this.fns.concat(window.eval("["+this._fns.join(",")+"]")),this._fns.length=0;for(var o=0,c=n.length;c>o;o++)e._setElAttr(n[o])}},r.pick(a.prototype,["destroy","undelegateEvents","listenTo","listen","onDestroy"])),k.extend=r.extend,e.State=k.prototype.$state=new k,e.ViewModel=k,e.Filters=y});define("core/touch2",["$","util","animation","../graphics/cubicBezier","./event"],function(t,e,n){var i=t("$"),s=(t("util"),t("animation")),o=t("../graphics/cubicBezier"),a=t("./event"),c=(Array.prototype.slice,new o(.08,.53,.2,.96)),u=function(t,e){var n=this,r=i(t);n.$el=r,n.el=r[0],n.options=i.extend({enableVertical:!0,enableHorizontal:!1},e),this.delegate("touchstart",n.options.children,n._start).delegate("touchmove",n.options.children,n._move).delegate("touchend",n.options.children,n._end)};return u.prototype=Object.create(a),i.extend(u.prototype,{minDelta:0,minX:0,maxX:0,minY:0,maxY:0,x:0,y:0,delegate:function(t,e,n){return"undefined"==typeof e&&"function"==typeof n&&(e=n),"function"==typeof e?this.$el.on(t,i.proxy(e,this)):this.$el.on(t,e,i.proxy(n,this)),this},_stopMomentum:function(){return this.momentum?(this.momentum.stop(),this._isClickStopAni=!0,!0):!1},_start:function(t){var e=this,n=t.touches[0];e.pointX=e.startPointX=e.sx=n.pageX,e.pointY=e.startPointY=e.sy=n.pageY,e.isTouchStop=!1,e.isTouchStart=!1,e.isTouchMoved=!1,e.startTime=t.timeStamp||Date.now(),e.startX=e.x,e.startY=e.y,e.isClickStopMomentum=e._stopMomentum(),e.timestamp=Date.now()},_move:function(t){if(!this.isTouchStop){var e=this,n=t.touches[0],i=e.startPointX-n.pageX,r=e.startPointY-n.pageY;if(e.deltaX=i,e.deltaY=r,!e.isTouchStart){var s=Math.abs(i)>=e.minDelta&&Math.abs(i)>Math.abs(r),o=!s;if(!o&&!s)return!1;if(o&&!e.options.enableVertical||s&&!e.options.enableHorizontal)return void this.stop();if(e.isTouchStart=!0,e.isDirectionY=o,e.isDirectionX=s,e.dir=s,e.isInit||(e.trigger(a.createEvent("init",{currentTarget:t.currentTarget})),e.isInit=!0),e.trigger(a.createEvent("start",{currentTarget:t.currentTarget})),e.isTouchStop)return}var l=e.startX+i,c=e.startY+r;return e.x=l<e.minX?e.minX+(l-e.minX)/2:l>e.maxX?e.maxX+(l-e.maxX)/2:l,e.y=c<e.minY?e.minY+(c-e.minY)/2:c>e.maxY?e.maxY+(c-e.maxY)/2:c,e.trigger(a.createEvent("move",{currentTarget:t.currentTarget})),e.isTouchMoved=!0,e.isMoveLeft=e.pointX-n.pageX>0?!0:e.pointX==n.pageX?e.isMoveLeft:!1,e.isMoveTop=e.pointY-n.pageY>0?!0:e.pointY==n.pageY?e.isMoveTop:!1,e.oldPointX=e.pointX,e.oldPointY=e.pointY,e.pointX=n.pageX,e.pointY=n.pageY,e.timestamp=Date.now(),!1}},_end:function(t){var e=this;if((!e.isTouchMoved||e.isTouchStop)&&e._isClickStopAni)return e._stop(),void(t.cancelTap=!0);if(e.isTouchMoved&&(e.isTouchMoved=!1,!e.isTouchStop)){if(e.isTouchStop=!0,i(t.target).trigger("touchcancel"),e.trigger("end"),e.options.enableHorizontal&&(e.x<e.minX||e.x>e.maxX)||e.options.enableVertical&&(e.y<e.minY||e.y>e.maxY))return void e.bounceBack();var r,o,u,h,p,d,f,n=t.changedTouches[0],a=e.x,l=e.y;return Date.now()-e.timestamp<50?(r=n.pageX-e.oldPointX,o=n.pageY-e.oldPointY,u=r*Math.abs(r),h=o*Math.abs(o),f=80*Math.abs(Math.max(r,o)),e.momentum=s.animate(function(t,n,i){t=c.get(n/i),p=a+u*t*-1,d=l+h*t*-1,e.options.enableVertical&&(d<e.minY||d>e.maxY)||e.options.enableHorizontal&&!e.options.enableVertical&&(p<e.minX||p>e.maxX)?(e.momentum.stop(),u=a-u,h=l-h,a=e.x,l=e.y,u=u<e.minX?e.minX+Math.max(-100,(u-e.minX)/36):u>e.maxX?e.maxX+Math.min(100,(u-e.maxX)/36):u,h=h<e.minY?e.minY+Math.max(-100,(h-e.minY)/36):h>e.maxY?e.maxY+Math.min(100,(h-e.maxY)/36):h,h-=l,u-=a,e.momentum=s.animate(function(t){e.x=a+u*t,e.y=l+h*t,e.trigger("move")},Math.min(200,(i-n)/4),"easeOutCubic",function(){e.bounceBack()})):(e.x=p<e.minX?e.minX:p>e.maxX?e.maxX:p,e.y=d,e.trigger("move"))},f,"ease",function(){e._stop()})):e._stop(),!1}},bounceBack:function(){var t=this,e=t.x,n=t.y,i=0,r=0;t.options.enableHorizontal&&(t.x<t.minX?i=t.minX-t.x:t.x>t.maxX&&(i=t.maxX-t.x)),t.options.enableVertical&&(t.y<t.minY?r=t.minY-t.y:t.y>t.maxY&&(r=t.maxY-t.y)),s.animate(function(s){t.x=e+i*s,t.y=n+r*s,t.trigger("move")},200,"ease",function(){t._stop()})},scrollTo:function(t,e,n){var i=this;if(t=i.options.enableHorizontal?t>=this.maxX?this.maxX:t<=this.minX?this.minX:t:i.x,e=i.options.enableVertical?e>=this.maxY?this.maxY:e<=this.minY?this.minY:t:i.x,n){var r=i.x,o=i.y,a=t-i.x,l=e-i.x;s.animate(function(t){i.x=r+a*t,i.y=o+l*t,i.trigger("move")},n,"ease")}else i.x=t,i.y=e,i.trigger("move")},stop:function(){this.isTouchStop=!0},_stop:function(){this.momentum=null,this._isClickStopAni=!1,this.trigger("stop")},destory:function(){this.$el.off("touchstart",this._start).off("touchmove",this._move).off("touchend",this._end)}}),u});
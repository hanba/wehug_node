define("components/form",function(require){var util=require("util"),T={html:function($data){var __="";with($data||{}){__+='<form action="'+util.encodeHTML(url)+'" method="'+util.encodeHTML(method)+'" enctype="'+util.encodeHTML(enctype||"multipart/form-data")+'" class="form"> ';for(var i=0,len=hiddens.length;len>i;i++){var field=hiddens[i];__+='<input type="hidden" name="'+util.encodeHTML(field.field)+'" sn-model="'+util.encodeHTML(name)+"."+util.encodeHTML(field.field)+'" sn-binding="value:'+util.encodeHTML(name)+"."+util.encodeHTML(field.field)+'" />'}__+=' <table width="100%"> <tbody> ';for(var i=0,len=fields.length;len>i;i++){var field,items=fields[i];__+="<tr> ",items.length||(items=[items]),__+=" ";for(var j=0,length=items.length;length>j;j++){field=items[j];var attr=' name="'+field.field+'" sn-model="'+name+"."+field.field+'" sn-binding="value:'+name+"."+field.field+'"';__+="<th "+(field.vAlign?'style="vertical-align:'+field.vAlign+'"':"")+">"+util.encodeHTML(field.label)+" ",field.emptyAble!==!1&&(__+="<i>*</i>"),__+='</th> <td colspan="'+util.encodeHTML(field.colSpan||1)+'"> ',"text"!=field.type&&field.type?"textarea"==field.type?__+='<textarea class="'+util.encodeHTML(field.className||"text")+'"'+attr+"></textarea>":"select"==field.type?__+='<select class="'+util.encodeHTML(field.className||"text")+'"'+attr+' sn-options="'+util.encodeHTML(field.options.text)+","+util.encodeHTML(field.options.value)+" in "+util.encodeHTML(field.options.data)+'"> </select>':"number"==field.type?__+='<input class="'+util.encodeHTML(field.className||"text_normal")+'" type="number"'+attr+"/>":"password"==field.type?__+='<input class="'+util.encodeHTML(field.className||"text")+'" type="password"'+attr+"/>":"file"==field.type?__+='<input type="file" name="'+util.encodeHTML(field.field)+'" sn-model="'+util.encodeHTML(name)+"."+util.encodeHTML(field.field)+'"/>':($data.plugins.push(field),__+='<input type="hidden"'+attr+">"):__+='<input class="'+util.encodeHTML(field.className||"text")+'" type="text"'+attr+"/>",__+=' <span sn-binding="class:'+util.encodeHTML(validator)+".result."+util.encodeHTML(field.field)+".success|case:-1:'msg_tip':true:'right_tip':false:'error_tip':'hide',html:"+util.encodeHTML(validator)+".result."+util.encodeHTML(field.field)+'.msg"></span> </td>'}__+=" </tr>"}__+=" </tbody> </table> </form> "}return __},helpers:{}};return T.template=T.html,T});define("components/validator",function(e,t,i){var l=e("$"),n=function(e){l.extend(this,e)};n.prototype={emptyAble:!0,emptyText:"不可为空",regex:null,regexText:null,compare:null,compareText:"",validate:null,validateText:null,success:""},i.exports=t=function(e,t){var i;this.options={},this.data=t;for(var l in e)i=e[l],this.options[l]=new n(i)},t.prototype.set=function(e){this.data=e},t.prototype.set=function(e){this.data=e},t.prototype.valid=function(e,t){return e?""!=t&&null!=t||e.emptyAble!==!1&&(!l.isFunction(e.emptyAble)||e.emptyAble())?""==t||null===e.regex||e.regex.test(t)?e.compare&&this.data[e.compare]!=t?{success:!1,msg:e.compareText}:e.validate&&!e.validate.call(this,t)?{success:!1,msg:e.validateText}:{success:!0,msg:"function"==typeof e.success?e.success.call(this,t):e.success}:{success:!1,msg:e.regexText}:{success:!1,msg:e.emptyText}:{success:!0}},t.prototype.validate=function(e){if(e)return this.valid(this.options[e],this.data[e]);var n,l={success:!0,result:{}};for(var e in this.options)n=this.valid(this.options[e],this.data[e]),l.result[e]=n,l.success&&(l.success&=n.success);return l}});define("components/formjs",function(e,t,i){var l=e("$"),s=e("./form"),n=e("util"),d=e("./validator"),a=["emptyAble","emptyText","regex","regexText","compare","compareText","validate","validateText","success"],o=0;i.exports=t=function(e){var i,s;this.hiddens=[],this.fields=[],this.plugins=[];var o={};for(var r in e)if(i=e[r],"fields"==r)for(var u=0,c=i.length;c>u;u++)if(s=i[u],"hidden"===s.type)this.hiddens.push(s);else{s.length||(s=[s]),this.fields.push(s);for(var f=0,p=s.length;p>f;f++){var m=s[f],h=n.pick(m,a);n.isEmptyObject(h)||(o[m.field]=h)}}else this[r]=i;this.model.set(this.name,{}),this.data=this.model.get(this.name).data,this.valid=new d(o,this.data),this.$el=l(this.template.html(this)),this.el=this.$el[0],this.$el.on("blur","[name]",l.proxy(this._validInput,this));for(var u=0,c=this.plugins.length;c>u;u++){var _=this.plugins[u],v=this.$el.find('[name="'+_.field+'"]');new t.require(_.type)(v,_)}},t.prototype={model:null,name:"form",template:s,useIframe:!1,validator:"valid",url:"",enctype:"",method:"post",fields:[],submit:function(e,t){var i=this.valid.validate(),s=this;if(this.model.set(this.validator,i),i.success)if(this.useIframe||this.$el.has('[type="file"]').length){o++;{var d,n="_submit_iframe"+o;l('<iframe style="top:-999px;left:-999px;position:absolute;display:none;" frameborder="0" width="0" height="0" name="'+n+'"></iframe>').appendTo(document.body).on("load",function(){var i=l.trim(this.contentWindow.document.body.innerHTML);if(!d||i!=d){d=i;try{e.call(s,JSON.stringify(d))}catch(n){t&&t.call(s,n,d)}}})}this.$el.attr("target",n).submit()}else l.ajax({url:this.url,type:"POST",dataType:"json",data:this.$el.serialize(),success:l.proxy(e,this),error:t&&l.proxy(t,this)})},_validInput:function(e){var t=l(e.currentTarget),i=t.attr("name"),s=this.valid.validate(i);this.model.data[this.validator]||this.model.set(this.validator,{result:{}}),this.model.set(this.validator+".result."+i,s)},destory:function(){this.$el.on("off","[name]",this._validInput)}};var r={};t.define=function(e,t){r[e.toLowerCase()]=t},t.require=function(e){return r[e.toLowerCase()]};var u=function(e,t){var i=this;this.$input=e,i.id="UMEditor"+u.guid++,e.before('<script type="text/plain" id="'+i.id+'" style="width:'+(t.width||500)+'px;height:240px;"></script>'),window.UMEDITOR_HOME_URL=seajs.resolve("components/umeditor/"),function(e){window.jQuery?e():seajs.use(["components/umeditor/third-party/jquery.min"],e)}(function(){seajs.use(["components/umeditor/umeditor.config","components/umeditor/umeditor","components/umeditor/themes/default/css/umeditor.css"],function(t){var l=UM.getEditor(i.id,{toolbar:["source | undo redo | bold italic underline strikethrough | removeformat | justifyleft justifycenter justifyright justifyjustify | link unlink | image"]});l.addListener("blur",function(){var t=l.getContent(),i=e[0].value;e.val(t),i!==t&&e.trigger("change"),e.trigger("blur")})})})};u.guid=0,t.define("RichTextBox",u)});define("components/grid",function(e,t,i){var s=e("$"),l=e("util"),n=e("../core/view").prototype,d=e("./page"),r=l.ie&&6==l.osVersion,o=function(e,t,i){var s;return s="number"==typeof e?i?e-t:t-e:(e+"").localeCompare(t+"")*(i?1:-1)},c=r?function(e){e.css({height:0,marginTop:-1})}:function(){$el.hide()},h=r?function(e,t){e.css({height:t,marginTop:""})}:function(){el.show()},u=["url","beforeSend","success","error","type"],p=function(e,t){var i=this,a=e.grid.options;if(this.$el=s(this.el).css(s.extend({width:t.curWidth,height:t.height,"text-align":t.align||"","float":"auto"==t.curWidth?"none":""},t.style)),this.options=t,this.el=this.$el[0],this.row=e,this.$body=0==t.index&&"tree"!=a.type&&a.children?s('<div class="grid_spread" data-rowindex="'+e.index+'"></div>').appendTo(this.$el):this.$el,0==t.index&&"tree"==a.type){for(var l=[],n=0;n<treeDeep;n++)l.push('<i class="grid_tree_space"></i>');this.$el.prepend(l.join(""));var d=e.data[a.subKey];d&&d.length?(s('<i class="grid_tree" data-treeid="'+e.treeId+'"></i>').appendTo(this.$el),e.$el.addClass("grid_tree_fold"),s.each(d,function(t,i){e.grid.append(i,e.treeDeep+1,e.treeId)})):s("<i class='grid_tree_nochild'></i>").appendTo(this.$el)}var r=e.data[t.bind]||t.defaultVal;if(t.render)t.render.call(i,e.data,e.grid._data);else if("textbox"==t.type){var o=s('<textarea class="grid_cell_textbox" data-row="'+e.index+'" data-cell="'+i.index+'"></textarea>').css({height:a.rowHeight}).val(r);i.$textbox=o,i.$body.append(o),i.on("change",function(e,t){this.$textbox.val(t),this.validate()}),i.validate=function(){var e=!1;return t.emptyAble===!1&&""==this.$textbox.val()?e=this.options.emptyText||this.options.text+"不可为空！":column.regex&&!column.regex.test(textbox.value)&&(e=this.options.regexText||this.options.text+"格式错误！"),e?this.$el.addClass("grid_cell_err").title=e:this.$el.removeClass("grid_cell_err").title="",!e}}else if("selector"==t.type){var c=s('<input class="grid_selector" data-row="'+e.index+'" type="'+(a.multiselect?"checkbox":"radio")+'" name="__gs_'+e.grid.cid+"'>").prop({checked:!1});i.$body.append(c),i.$selector=e.$selector=c}else"center"==t.valign?i.$body=s('<table style="height:100%;width:100%;"><tr><td></td></tr></table>').appendTo(i.$body).find("td").html(r):i.cellItem(r);e.$el.append(i.$el)};p.prototype={trigger:n.trigger,on:n.on,el:'<li class="grid_cell"></li>',$:function(e){return this.$el.find(e)},cellItem:function(e){this.$body.hasClass("grid_cell_item")?this.$body.html(e):this.$body=s("<div class='grid_cell_item'>"+e+"</div>").appendTo(this.$body)},append:function(e){return this.$el.append(e),this},html:function(e){return"undefined"==typeof e?this.$body.html():(this.$body.html(e),this)},val:function(e){return"undefined"==typeof a?this.value:("string"==typeof e&&/^\/Date\(\d+\)\/$/.test(e)&&(e=l.formatDate(e)),this.value=e,this.options.bind&&(row.data[this.options.bind]=e),this.$textbox?this.$textbox.val(e):this.options.render?options.render.call(self,row.data,row.grid._data):this.html(e),this.trigger("change",e),this)}};var f=function(e,t){this.grid=e,this.$el=s(this.el).css({height:t.height}).data("index",t.index),this.el=this.$el[0],this.data=t.data,this.index=t.index,this.cells=[]};f.prototype={el:'<ul class="grid_row"></ul>',data:null,selected:!1,select:function(){this.selected||(this.selected=!0,this.$el.addClass("grid_row_cur"),this.selector&&this.selector.prop({checked:!0}),this.grid.selectedRows.push(this),this.grid.selectedRow=this,this.grid.trigger("SelectRow",this))},cancelSelect:function(){if(this.selected){this.selected=!1,this.$el.removeClass("grid_row_cur"),this.selector&&this.selector.prop({checked:!1});for(var e=this.grid,t=e.selectedRows,i=0,s=t.length;s>i;i++)if(t[i]==this){t.splice(i,1);break}e.selectedRow==this&&(e.selectedRow=0!=t.length?t[t.length-1]:null)}},cell:function(e,t){return void 0===t?this.cells[e]:(this.cells[e]=new p(this,t),this)},append:function(e){return this.cells.push(new p(this,e)),this},spread:function(){this.$el.find(".grid_spread").removeClass("grid_spread").addClass("grid_fold"),this.childContainer.removeClass("grid_child_non").addClass("grid_child_con")},fold:function(){this.$el.find(".grid_fold").removeClass("grid_fold").addClass("grid_spread"),this.childContainer.removeClass("grid_child_con").addClass("grid_child_non")}};var g=function(e,t){var i=this;i.options=t=s.extend(!0,{type:"grid",pageEnabled:!1,rowHeight:24,height:"auto",multiselect:!1,subKey:"children",data:[],columns:[],children:null,search:null,onSelectRow:l.noop},t),s.each(t.columns,function(e,i){t.columns[e]=s.extend({text:"",bind:"",render:null,width:10,align:"left",valign:"top",type:"normal",style:{},css:"",defaultVal:""},i)}),i.$container=s(e),i.$el=s(i.el),i.el=i.$el[0],i.$header=i.$el.find(".grid_header"),i.$body=i.$el.find(".grid_body"),i.cid=l.guid(),i.listen(i.events),"tree"==t.type&&(i.treeDeepRecord=[]),i.rows=[],i.selectedRows=[],i.adjustWidth(),i.createHead(),i.createSearch(),t.pageEnabled&&(i.page=new d({id:s("<DIV class='page'>共0条数据</DIV>").appendTo(i.$el),page:1,pageSize:10,total:0,onChange:function(e){i.ajaxSettings.data.page=e,i.load()}})),i.$el.appendTo(i.$container)};g.prototype={events:{"click .grid_header .sortable":function(e){var t=this,i=s(e.currentTarget),a=t.ajaxSettings.data,l=i.data("bind");a.sort=l,t.currentSort!=e.currentTarget&&(i.removeClass("sort_desc sort_asc"),t.currentSort=e.currentTarget);var n=!i.hasClass("sort_asc");return n?i.removeClass("sort_desc").addClass("sort_asc"):i.removeClass("sort_asc").addClass("sort_desc"),a.asc=n,t.options.pageEnabled?(a.page=1,t.load()):(t._data.sort(function(e,t){return o(e[l],t[l],n)}),t.rows.sort(function(e,t){var i=o(e.data[l],t.data[l],n);return i>0?t.$el.insertBefore(e.$el):0>i&&e.$el.insertBefore(t.$el),i})),!1},"click .grid_header .grid_spread,.grid_fold":function(e){var t=s(e.currentTarget);return t.hasClass("grid_spread")?(t.removeClass("grid_spread").addClass("grid_fold"),s.each(this.rows,function(e,t){t.spread()})):(t.removeClass("grid_fold").addClass("grid_spread"),s.each(this.rows,function(e,t){t.fold()})),!1},"click .grid_body .grid_spread,.grid_fold":function(e){var t=s(e.currentTarget);return t.hasClass("grid_spread")?this.rows[t.data("rowindex")].spread():this.rows[t.data("rowindex")].fold(),!1},"click .js_grid_selector":function(e){s(e.currentTarget);this.$el.find("input[name='__gs_"+this.cid+"']").prop({checked:this.checked});var i=this.checked?"select":"cancelSelect";if(this.selectedRows.length=0,this.selectedRow=!1,s.each(this.rows,function(e,t){t[i]()}),0==this.selectedRows.length)this.selectedRow=null;else{var a=this.selectedRows[0];a!=this.selectedRow&&(this.selectedRow=a)}return!1},"click .grid_row":function(e){var t=this.rows[s(e.currentTarget).data("index")];return this.options.multiselect?e.target.name!="__gs_"+this.cid&&t[t.selected?"cancelSelect":"select"]():this.selectedRow!=t&&(this.selectedRow&&this.selectedRow.cancelSelect(),t.select()),!1},"click .grid_tree":function(e){var t=this,i=s(e.currentTarget).closest(".grid_row"),a=i.data("treeid"),l=this.$el.find("[parenttree^='"+a+"_']");return i.hasClass("grid_tree_fold")?(i.removeClass("grid_tree_fold").addClass("grid_tree_spread"),c(l)):(i.removeClass("grid_tree_spread").addClass("grid_tree_fold"),l.each(function(e,i){i=s(i),t.$body.find('[data-treeid="'+i.data("treeid").replace(/_\d+$/,"")+'"]').hasClass("grid_tree_fold")&&h(i,t.options.rowHeight)})),!1},"blur .grid_cell_textbox":function(e){var t=s(e.currentTarget);return this.cell(t.data("row"),t.data("cell")).validate(),!1},"click .grid_selector":function(e){if(this.options.multiselect){var t=e.currentTarget,i=this.rows[s(t).data("row")];t.checked?i.select():i.cancelSelect()}},"click .grid_search":"search"},on:n.on,trigger:n.trigger,listen:n.listen,cell:function(e,t){return this.rows[e].cells[t]},ajaxSettings:{},el:'<div class="grid_cont"><div class="grid"><div class="grid_border_r"><div class="grid_header_cont"><ol class="grid_header"></ol></div><div class="grid_body"></div></div></div></div>',load:function(){},adjustWidth:function(){var d,e=this.options,t=e.columns.length-1,i=0,a=0,n=0,o=[];s.each(e.columns,function(e,t){t.width=parseInt(t.width),t.hide||(n+=t.width)});for(var c=0;t>c;c++)d=e.columns[c],i=Math.round(100*d.width/n),o[c]=i,a+=i;o[t]=l.ie?"auto":100-a,this.columnWidths=o},createHead:function(){var e=this,t=e.options,i=e.columnWidths;s.each(t.columns,function(a,l){var r,n="number"==typeof i[a]?i[a]+"%":i[a],d=s("<li></li>");l.index=a,"selector"==l.type&&t.multiselect?(r=s('<input class="js_grid_selector" type="checkbox" data-cid="'+e.cid+'" />').prop({checked:!1}),l.align="center",n=50):(r=s("<a>"+l.text+"</a>"),0==a&&t.children&&(s("<div class='grid_spread'></div>").append(r).appendTo(cell),l.align="left"),(l.sortAble||l.sortable)&&l.bind&&r.addClass("sortable").attr("data-bind",l.bind)),l.curWidth=n,d.append(r).css({textAlign:l.align,width:n,"float":"auto"==n?"none":""}).appendTo(e.$header)})},msg:function(e){var t=this.$body[0].offsetHeight||100;this.$body.html('<div style="border-bottom: 1px solid #cdcdcd;height:'+t+"px;line-height:"+t+'px;text-align:center">'+e+"</div>")},data:function(e){var t=this;return void 0===e?t._data:(t._data=e,null!=e&&e.length?(t.$body.html(""),void s.each(e,function(e,i){t.append(i)})):void t.msg("暂无数据"))},append:function(e,t,i){var a=this,l=a.options,n=new f(a,{data:e,index:a.rows.length});if(a.rows.push(n),"tree"!=l.type&&l.children){var d,r=s('<div class="grid_child_non"></div>').appendTo(a.$body);n.childContainer=r,n.children=[],s.each(l.children,function(t,i){"function"==typeof i.render?n.children.push(i.render(r,e,n)):(l.subKey&&(i.data=e[l.subKey]),d=new g(s("<div></div>").appendTo(r),i),d.parentRow=n,n.children.push(d))})}else"tree"==l.type&&(t=t||0,a.treeDeepRecord[t]=a.treeDeepRecord[t]?a.treeDeepRecord[t]+1:1,n.treeDeep=t,i=i||0,n.parentTreeId=i,n.treeId=i+"_"+a.treeDeepRecord[t],n.$el.attr({"data-treeid":subtree}));s.each(l.columns,function(e,t){n.append(t)}),a.$body.append(n.$el)},load:function(){var e=this,t=e.ajaxSettings,i=t.data;e.msg("正在载入..."),e.page&&e.page.clear(),t.beforeSend&&t.beforeSend.call(e,i),s.ajax({url:t.url,type:t.type||"POST",data:i,dataType:"json",cache:!1,success:function(s){s.success?(e.data(s.data),e.options.pageEnabled&&(e.page.change({page:i.page,pageSize:i.pageSize,total:s.total}),e.trigger("PageChange",i.page)),t.success&&t.success.call(e,s.data)):e.msg("string"==typeof s.msg?s.msg:JSON.stringify(s.msg))},error:function(i){t.error?t.error.call(e,i):e.msg(i.responseText)}})},search:function(e){var t=this,i=s.extend(!0,{},t.ajaxSettings,!e||e.target?{}:e);t.ajaxSettings=i;var a=i.data||(i.data={});t.options.pageEnabled&&(a.page=1),t.controls&&s.each(t.controls,function(e,t){a[e]=t.$el.val()}),t.load()},createSearch:function(){var e=this,t=this.options.search;if(e.ajaxSettings.data={},t){s.extend(e.ajaxSettings,l.pick(t,u));var i={},a=t.data;if(a&&s.each(a,function(t,l){s.isPlainObject(l)?(i[t]=l,a[t]=""):e.ajaxSettings.data[t]=l}),i&&!s.isEmptyObject(i)){e.controls=i;var n=s('<div class="search"></div>'),d=!1;s.each(i,function(t,a){a=s.extend({label:"",name:""||t,className:"text",type:"text",value:"",render:null,width:null,options:null,newLine:!1},a),a.newLine&&n.append("<br>"),a.label?s("<i>"+a.label+"</i>").appendTo(n):n.append(" ");var l=a.name,r={name:l,type:a.type};if(s.isFunction(a.render)){var o=a.render.call(e,n);"string"==typeof o&&n.append(o),r.type="render",r.$el=n.find('[name="'+l+'"]')}else"calendar"==a.type?(o=s('<input name="'+l+'" class="'+a.className+'" type="text"/>'),seajs.use(["./components/jquery.datepicker","./components/jquery.datepicker.css"],function(){o.datePicker(s.extend(a.options,{clickInput:!0}))})):"select"==a.type?(o=s('<select name="'+l+'"></select>'),s.isArray(opt.options)&&s.each(opt.options,function(e,t){o.each(function(){this.options.add(new Option(t.text,t.value))})}),a.change&&o.on("change",a.change)):o=s('<input type="'+a.type+'" name="'+l+'" class="'+a.className+'"/>'),a.width&&o.css({width:width}),o.appendTo(n).val(a.value),r.$el=o;"hidden"!=r.type&&(d=!0),i[t]=r}),d?e.$searchBtn=s('<button class="grid_search button">搜索</button>').appendTo(n):n.hide(),e.$search=n,e.$el.prepend(n)}}}},i.exports=g});define("components/page",function(e,t,i){function d(e){this.options=s.extend({id:"",page:1,pageSize:10,total:0,onChange:function(e){},msg:"共<%=total%>条数据&nbsp;&nbsp;每页<%=pageSize%>&nbsp;&nbsp;当前第<%=page%>/<%=totalPages%>页"},e),this.container=s(e.id),this.draw()}var s=e("$"),a=e("util"),n=a.template,l=function(e,t){return t=t||e,'<a href="javascript:void(0);" page="'+e+'">'+t+"</a>"};d.prototype={draw:function(){var e=this.options,t=this.container,i=e.pageSize||10;e.pageSize=i;var a=e.totalPages=(e.total-(e.total%i||i))/i+1;if(a>0){t.html(n(e.msg,e)),t=s("<div></div>").appendTo(t);var d="",r=parseInt(e.page),i=(e.total,e.pageSize),c=e.onChange,p=bind(this._serialButtons,this);d+=1==r?"<span>第一页</span><span>上一页</span>":l(1,"第一页")+l(r-1,"上一页"),7>=a?d+=p(1,a):(d+=5>r?p(1,5)+"&nbsp;...&nbsp;":p(1,2)+"&nbsp;...&nbsp;"+(r+3>=a?p(a-4,a-1):p(r-1,r+2)+"&nbsp;...&nbsp;"),d+=p(a,a)),d+=a==r?"<span>下一页</span><span>最后一页</span>":l(r+1,"下一页")+l(a,"最后一页"),t.html(d).find("a").click(function(){c(this.getAttribute("page"))})}else t.html("共0条数据")},change:function(e){"number"==typeof e?this.options.page=page:s.extend(this.options,e),this.draw()},clear:function(){this.container.html("&nbsp;")},_serialButtons:function(e,t){var i=this.options.page;html="";for(var s=e;t>=s;s++)html+=s==i?"<span>"+s+"</span>":l(s);return html}},i.exports=d});